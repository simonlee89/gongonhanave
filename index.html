<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„¤ì´ë²„ ì§€ë„ - ë¶€ë™ì‚° ë§¤ë¬¼ ì§€ë„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #F9FAFB;
            font-family: 'Pretendard', 'Noto Sans KR', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #191F28;
        }
        .map-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #map {
            width: 100vw;
            height: 100vh;
        }
        .filter-toggle-btn {
            position: absolute;
            top: 18px;
            left: 18px;
            background: #3182F6;
            color: #fff;
            border: none;
            border-radius: 8px; /* 12px * 0.7 = 8.4px â†’ 8px */
            padding: 11px 22px; /* 16px 32px â†’ 11px 22px (30% ì¶•ì†Œ) */
            font-size: 16px; /* 22px * 0.73 = 16px */
            font-weight: 700;
            cursor: pointer;
            z-index: 1100;
            box-shadow: 0 4px 16px rgba(49,130,246,0.18);
            transition: background 0.2s, box-shadow 0.2s, font-size 0.2s;
        }
        .filter-toggle-btn.collapsed {
            background: #1B64DA;
            color: #fff;
            font-size: 19px; /* 26px * 0.73 = 19px */
            padding: 14px 28px; /* 20px 40px â†’ 14px 28px (30% ì¶•ì†Œ) */
            box-shadow: 0 6px 24px rgba(49,130,246,0.25);
        }
        .filter-container {
            position: absolute;
            top: 32px;
            left: 32px;
            background: #FFFFFF;
            border-radius: 13px;
            box-shadow: 0 4px 16px rgba(49,130,246,0.08);
            padding: 39px 17px 17px 17px; /* 30% ì¶•ì†Œ (56pxâ†’39px, 24pxâ†’17px) */
            width: 343px; /* 490px * 0.7 = 343px (30% ì¶•ì†Œ) */
            min-width: 224px; /* 320px * 0.7 */
            max-width: 343px;
            z-index: 1001;
            transition: box-shadow 0.2s, opacity 0.2s, transform 0.2s;
        }
        .filter-container.collapsed {
            padding: 0;
            min-width: 0;
            max-width: 140px; /* 200px * 0.7 = 140px */
            height: 0;
            overflow: hidden;
            opacity: 0.95;
            box-shadow: none;
        }
        .filter-content { transition: max-height 0.3s, opacity 0.3s; }
        .filter-container.collapsed .filter-content { display: none; }
        .filter-row {
            display: flex;
            align-items: center;
            margin-bottom: 13px; /* 18px * 0.7 = 12.6px â†’ 13px */
            gap: 8px; /* 12px * 0.7 = 8.4px â†’ 8px */
            flex-wrap: wrap;
        }
        .filter-label {
            font-weight: 600;
            color: #333D4B;
            margin-right: 6px; /* 8px * 0.7 = 5.6px â†’ 6px */
            min-width: 49px; /* 70px * 0.7 = 49px */
            font-size: 13px; /* ê¸°ë³¸ í°íŠ¸ í¬ê¸° ì•½ê°„ ì¶•ì†Œ */
        }
        /* ê° í•„í„° ê·¸ë£¹ë³„ ë°°ê²½ìƒ‰ (ë” ë‹¤ì–‘í•˜ê²Œ) */
        .filter-row.search-row { background: #E8F3FF; border-radius: 7px; padding: 7px 8px; } /* 30% ì¶•ì†Œ */
        .filter-row.type-row { background: #D0F5F5; border-radius: 7px; padding: 7px 8px; }
        .filter-row.region-row { background: #F3E8FF; border-radius: 7px; padding: 7px 8px; }
        .filter-row.status-row { background: #E0ECFF; border-radius: 7px; padding: 7px 8px; }
        .filter-row.price-row { background: #F9FAFB; border-radius: 7px; padding: 7px 8px; }
        .filter-row.date-row { background: #FFF7E0; border-radius: 7px; padding: 7px 8px; }
        .filter-radio-group {
            display: flex;
            gap: 6px; /* 8px * 0.7 = 5.6px â†’ 6px */
        }
        /* ë¼ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹ë³„ ë°°ê²½ìƒ‰ */
        .type-row .radio-btn { background: #B2EBF4; }
        .region-row .radio-btn { background: #E1D5FA; }
        .status-row .radio-btn { background: #B3D8FF; }
        .radio-btn {
            border-radius: 6px; /* 8px * 0.7 = 5.6px â†’ 6px */
            padding: 6px 13px; /* 8px 18px â†’ 6px 13px (30% ì¶•ì†Œ) */
            font-weight: 500;
            color: #6B7684;
            font-size: 13px; /* ê¸°ë³¸ í°íŠ¸ í¬ê¸° ì¶•ì†Œ */
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            border: 2px solid transparent;
            user-select: none;
        }
        .radio-btn input[type="radio"] {
            display: none;
        }
        .radio-btn:has(input[type="radio"]:checked) {
            background: #3182F6 !important;
            color: #fff !important;
            border: 2px solid #1B64DA;
        }
        input[type="text"], input[type="number"] {
            border: 1.5px solid #E5E8EB;
            border-radius: 6px; /* 8px * 0.7 = 5.6px â†’ 6px */
            padding: 6px 8px; /* 8px 12px â†’ 6px 8px (30% ì¶•ì†Œ) */
            font-size: 14px; /* 16px * 0.875 = 14px */
            background: #F9FAFB;
            color: #191F28;
            outline: none;
            transition: border 0.2s;
        }
        input[type="text"]:focus, input[type="number"]:focus {
            border: 1.5px solid #3182F6;
            background: #E8F3FF;
        }
        #search-btn {
            background: #3182F6;
            color: #fff;
            font-weight: 700;
            border: none;
            border-radius: 7px; /* 10px * 0.7 = 7px */
            padding: 8px 22px; /* 12px 32px â†’ 8px 22px (30% ì¶•ì†Œ) */
            font-size: 16px; /* 18px * 0.89 = 16px */
            box-shadow: 0 2px 8px rgba(49,130,246,0.10);
            cursor: pointer;
            transition: background 0.2s;
        }
        #search-btn:hover, #search-btn:active {
            background: #1B64DA;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .error-message {
            background: #e74c3c;
            color: white;
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        .status-bar {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }
        /* ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ì—ì„œë§Œ ì ìš© (ì‘ì€ í™”ë©´ + í„°ì¹˜ ë””ë°”ì´ìŠ¤) */
        @media (max-width: 768px) and (pointer: coarse) {
            .filter-toggle-btn {
                left: 2vw;
                top: 2vw;
                font-size: 16px; /* 18px * 0.89 = 16px */
                padding: 8px 14px; /* 12px 20px â†’ 8px 14px (30% ì¶•ì†Œ) */
            }
            .filter-container {
                width: calc(100vw - 4vw); /* ê³ ì • ë„ˆë¹„ ëŒ€ì‹  ë°˜ì‘í˜• */
                max-width: 98vw;
                min-width: 0;
                padding: 39px 4px 8px 4px; /* 56px 6px 12px 6px â†’ 39px 4px 8px 4px (30% ì¶•ì†Œ) */
                left: 2vw;
                top: 2vw;
            }
        }
        #passwordModal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.45);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #passwordBox {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            padding: 40px 32px 32px 32px;
            min-width: 320px;
            text-align: center;
        }
        #passwordInput {
            font-size: 20px;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1.5px solid #3182F6;
            margin-bottom: 18px;
            width: 80%;
        }
        #passwordSubmit {
            background: #3182F6;
            color: #fff;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            padding: 12px 32px;
            font-size: 18px;
            cursor: pointer;
        }
        #passwordError {
            color: #e74c3c;
            margin-top: 10px;
            font-size: 15px;
        }
    </style>
</head>
<body>
    <div id="passwordModal">
      <div id="passwordBox">
        <h2 style="margin-bottom:18px; color:#3182F6;">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h2>
        <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸" autocomplete="off" />
        <br/>
        <button id="passwordSubmit">í™•ì¸</button>
        <button id="changePasswordBtn" style="margin-left:12px; background:#E5E8EB; color:#3182F6; font-weight:600; border:none; border-radius:8px; padding:12px 24px; font-size:16px; cursor:pointer;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
        <div id="passwordError"></div>
        <div id="changePasswordBox" style="display:none; margin-top:24px;">
          <h3 style="color:#3182F6; margin-bottom:10px;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
          <input type="password" id="oldPasswordInput" placeholder="ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸" style="margin-bottom:8px; width:80%; font-size:16px; padding:8px; border-radius:6px; border:1.5px solid #3182F6;" />
          <br/>
          <input type="password" id="newPasswordInput" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" style="margin-bottom:8px; width:80%; font-size:16px; padding:8px; border-radius:6px; border:1.5px solid #3182F6;" />
          <br/>
          <button id="submitChangePassword" style="background:#3182F6; color:#fff; font-weight:700; border:none; border-radius:8px; padding:8px 24px; font-size:16px; cursor:pointer;">ë³€ê²½</button>
          <button id="cancelChangePassword" style="margin-left:8px; background:#E5E8EB; color:#3182F6; font-weight:600; border:none; border-radius:8px; padding:8px 18px; font-size:15px; cursor:pointer;">ì·¨ì†Œ</button>
          <div id="changePasswordError" style="color:#e74c3c; margin-top:8px; font-size:14px;"></div>
        </div>
      </div>
    </div>
    <!-- ê´€ë¦¬ì ì¸ì¦ ëª¨ë‹¬ -->
    <div id="adminModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.45); z-index:10000; display:none; align-items:center; justify-content:center;">
        <div style="background:#fff; border-radius:16px; box-shadow:0 4px 24px rgba(0,0,0,0.18); padding:32px; min-width:280px; text-align:center;">
            <h3 style="margin-bottom:16px; color:#FFD700;">ê´€ë¦¬ì ì¸ì¦</h3>
            <input type="password" id="adminPasswordInput" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸" style="font-size:18px; padding:10px 14px; border-radius:8px; border:1.5px solid #FFD700; margin-bottom:14px; width:80%;" />
            <br/>
            <button id="adminSubmitBtn" style="background:#FFD700; color:#333; font-weight:700; border:none; border-radius:8px; padding:10px 24px; font-size:16px; cursor:pointer;">í™•ì¸</button>
            <button id="adminCancelBtn" style="margin-left:8px; background:#E5E8EB; color:#333D4B; font-weight:600; border:none; border-radius:8px; padding:10px 18px; font-size:15px; cursor:pointer;">ì·¨ì†Œ</button>
            <div id="adminError" style="color:#e74c3c; margin-top:10px; font-size:14px;"></div>
        </div>
    </div>
    <!-- ì‚¬ìš©ì ì¸ì¦ ëª¨ë‹¬ -->
    <div id="userModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.45); z-index:10000; align-items:center; justify-content:center;">
        <div style="background:#fff; border-radius:16px; box-shadow:0 4px 24px rgba(0,0,0,0.18); padding:32px; min-width:280px; text-align:center;">
            <h3 id="userModalTitle" style="margin-bottom:16px; color:#3182F6;">ì‚¬ìš©ì ì¸ì¦</h3>
            <input type="password" id="userPasswordInput" placeholder="ë¹„ë°€ë²ˆí˜¸" style="font-size:18px; padding:10px 14px; border-radius:8px; border:1.5px solid #3182F6; margin-bottom:14px; width:80%;" />
            <br/>
            <button id="userSubmitBtn" style="background:#3182F6; color:#fff; font-weight:700; border:none; border-radius:8px; padding:10px 24px; font-size:16px; cursor:pointer;">í™•ì¸</button>
            <button id="userCancelBtn" style="margin-left:8px; background:#E5E8EB; color:#333D4B; font-weight:600; border:none; border-radius:8px; padding:10px 18px; font-size:15px; cursor:pointer;">ì·¨ì†Œ</button>
            <div id="userError" style="color:#e74c3c; margin-top:10px; font-size:14px;"></div>
        </div>
    </div>
    <div class="map-container">
        <div id="map"></div>
        <button class="filter-toggle-btn" id="filterToggleBtn">í•„í„° ì ‘ê¸°</button>
        <div class="filter-container" id="filterContainer">
          <div class="filter-content" id="filterContent">
            <div class="filter-row search-row">
              <input type="text" id="search-input" placeholder="ì§€ì—­ëª… ë˜ëŠ” ì£¼ì†Œë¡œ ê²€ìƒ‰ " style="flex:1; min-width:126px;" />
            </div>
            <div class="filter-row type-row">
              <div class="filter-label">ë§¤ë¬¼ ìœ í˜•</div>
              <div class="filter-radio-group" id="type-group">
                <label class="radio-btn"><input type="radio" name="type" value="villa" checked />ë¹Œë¼</label>
              </div>
            </div>
            <div class="filter-row region-row">
              <div class="filter-label">ì§€ì—­</div>
              <div class="filter-radio-group" id="region-group">
                <label class="radio-btn"><input type="checkbox" name="region" value="gangnam" />ê°•ë‚¨</label>
                <label class="radio-btn"><input type="checkbox" name="region" value="songpa" />ì†¡íŒŒ</label>
              </div>
            </div>
            <div class="filter-row status-row">
              <div class="filter-label">êµ¬ë¶„</div>
              <div class="filter-radio-group" id="status-group">
                <label class="radio-btn"><input type="checkbox" name="status" value="ì „ì„¸" />ì „ì„¸</label>
                <label class="radio-btn"><input type="checkbox" name="status" value="ì›”ì„¸" />ì›”ì„¸</label>
              </div>
            </div>
            <div class="filter-row status-row">
              <div class="filter-label">ë§¤ë¬¼ ìƒíƒœ</div>
              <div class="filter-radio-group" id="category-group">
                <label class="radio-btn"><input type="checkbox" name="category" value="ê³µí´" />ê³µí´</label>
                <label class="radio-btn"><input type="checkbox" name="category" value="ì˜¨í•˜" />ì˜¨í•˜</label>
                <label class="radio-btn"><input type="checkbox" name="category" value="ê° ë§¤" />ê° ë§¤</label>
              </div>
              <label style="margin-left:11px; font-weight:600; color:#3182F6; cursor:pointer; user-select:none; font-size:13px;">
                <input type="checkbox" id="singleOnlyCheckbox" style="vertical-align:middle; margin-right:4px;" />ë§¤ë¬¼1ê°œë§Œ
              </label>
              <label style="margin-left:11px; font-weight:600; color:#FFD700; cursor:pointer; user-select:none; font-size:13px; background:#333; padding:4px 8px; border-radius:4px;">
                <input type="checkbox" id="bingoOnlyCheckbox" style="vertical-align:middle; margin-right:4px;" />ë¹™ê³ 
              </label>
              <label style="margin-left:11px; font-weight:600; color:#E91E63; cursor:pointer; user-select:none; font-size:13px; background:#FFF0F5; padding:4px 8px; border-radius:4px;">
                <input type="checkbox" id="recommendOnlyCheckbox" style="vertical-align:middle; margin-right:4px;" />ì¶”ì²œ
              </label>
              <!-- ìƒ‰ê¹” í•„í„° (ë¡œê·¸ì¸ ì‹œë§Œ í‘œì‹œ) -->
              <span id="colorFilterRow" style="display:none; margin-left:8px;">
                <label style="cursor:pointer; font-size:16px; padding:2px 4px;" title="ë¹¨ê°•"><input type="checkbox" id="redFilterCheckbox" style="display:none;" />ğŸ”´</label>
                <label style="cursor:pointer; font-size:16px; padding:2px 4px;" title="ì£¼í™©"><input type="checkbox" id="orangeFilterCheckbox" style="display:none;" />ğŸŸ </label>
                <label style="cursor:pointer; font-size:16px; padding:2px 4px;" title="ë³´ë¼"><input type="checkbox" id="purpleFilterCheckbox" style="display:none;" />ğŸŸ£</label>
                <label style="cursor:pointer; font-size:16px; padding:2px 4px;" title="ì´ˆë¡"><input type="checkbox" id="greenFilterCheckbox" style="display:none;" />ğŸŸ¢</label>
              </span>
            </div>
            <div class="filter-row price-row">
              <div class="filter-label">ë³´ì¦ê¸ˆ</div>
              <input type="number" id="deposit-min" placeholder="ìµœì†Œ(ë§Œì›)" style="width:63px;" />
              <span>~</span>
              <input type="number" id="deposit-max" placeholder="ìµœëŒ€(ë§Œì›)" style="width:63px;" />
            </div>
            <div class="filter-row price-row">
              <div class="filter-label">ì›”ì„¸</div>
              <input type="number" id="rent-min" placeholder="ìµœì†Œ(ë§Œì›)" style="width:63px;" />
              <span>~</span>
              <input type="number" id="rent-max" placeholder="ìµœëŒ€(ë§Œì›)" style="width:63px;" />
            </div>
            <div class="filter-row price-row">
              <div class="filter-label">ë°©ìˆ˜</div>
              <div class="filter-radio-group" id="room-group">
                <label class="radio-btn"><input type="radio" name="room" value="" checked />ì „ì²´</label>
                <label class="radio-btn"><input type="radio" name="room" value="1" />1ê°œ</label>
                <label class="radio-btn"><input type="radio" name="room" value="2" />2ê°œ</label>
                <label class="radio-btn"><input type="radio" name="room" value="3" />3ê°œ ì´ìƒ</label>
              </div>
            </div>
            <div class="filter-row date-row" style="background:#FFF7E0; border-radius:7px; padding:6px 7px;">
              <div class="filter-label">ë“±ë¡ì¼</div>
              <div class="filter-radio-group" id="date-group">
                <label class="radio-btn" style="background:#4CAF50; padding:3px 6px; font-size:10px; font-weight:600;"><input type="radio" name="date" value="0" />ì˜¤ëŠ˜</label>
                <label class="radio-btn" style="background:#FFE082; padding:3px 6px; font-size:10px;"><input type="radio" name="date" value="1" />ì–´ì œ</label>
                <label class="radio-btn" style="background:#FFD54F; padding:3px 6px; font-size:10px;"><input type="radio" name="date" value="2" />2ì¼ ì „</label>
                <label class="radio-btn" style="background:#FFCA28; padding:3px 6px; font-size:10px;"><input type="radio" name="date" value="3" />3ì¼ ì „</label>
                <label class="radio-btn" style="background:#FFC107; padding:3px 6px; font-size:10px;"><input type="radio" name="date" value="4" />4ì¼ ì „</label>
                <label class="radio-btn" style="background:#FFB300; padding:3px 6px; font-size:10px;"><input type="radio" name="date" value="5" />5ì¼ ì „</label>
                <label class="radio-btn" style="background:#FFA000; padding:3px 6px; font-size:10px;"><input type="radio" name="date" value="6" />6ì¼ ì „</label>
                <label class="radio-btn" style="background:#FF8F00; padding:3px 6px; font-size:10px;"><input type="radio" name="date" value="7" />7ì¼ ì „</label>
                <label class="radio-btn" style="background:#F9FAFB; padding:3px 6px; font-size:10px;"><input type="radio" name="date" value="" checked />ì „ì²´</label>
              </div>
            </div>
            <div class="filter-row" style="justify-content:center; gap:11px;">
              <button id="search-btn">ë§¤ë¬¼ ê²€ìƒ‰í•˜ê¸°</button>
              <button id="reset-btn" style="background:#E5E8EB; color:#333D4B; font-weight:600; border:none; border-radius:7px; padding:8px 17px; font-size:14px; margin-left:6px; cursor:pointer;">í•„í„° ì´ˆê¸°í™”</button>
            </div>
          </div>
        </div>
        <div class="loading" id="loading">
            <p>ğŸ—ºï¸ ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        <div class="status-bar" id="statusBar">
            ì‹œìŠ¤í…œ ì¤€ë¹„ ì¤‘...
        </div>
        <div style="position: absolute; top: 18px; right: 18px; background: #191F28; color: white; padding: 12px 20px; border-radius: 10px; font-size: 16px; font-weight: 600; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.15);" id="totalCount">
            ì´ ë§¤ë¬¼: 0ê°œ
        </div>
        <!-- ê´€ë¦¬ì ëª¨ë“œ ë²„íŠ¼ -->
        <button id="adminModeBtn" style="position: absolute; top: 60px; right: 18px; background: #6B7684; color: white; padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 500; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.15); border: none; cursor: pointer;">
            ê´€ë¦¬ì
        </div>
        <div style="position: absolute; top: 100px; right: 18px; background: #6366F1; color: white; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 500; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.15);" id="shownCount">
            í‘œì‹œ ì¤‘: 0ê°œ
        </div>
        <!-- ì‚¬ìš©ì ë¡œê·¸ì¸ ë²„íŠ¼ë“¤ -->
        <button id="wiplusModeBtn" style="position: absolute; top: 145px; right: 18px; background: #6B7684; color: white; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 500; z-index: 1000; box-shadow: 0 2px 6px rgba(0,0,0,0.15); border: none; cursor: pointer;">
            ìœ„í”ŒëŸ¬ìŠ¤
        </button>
        <button id="binsheetModeBtn" style="position: absolute; top: 175px; right: 18px; background: #6B7684; color: white; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 500; z-index: 1000; box-shadow: 0 2px 6px rgba(0,0,0,0.15); border: none; cursor: pointer;">
            ë¹ˆì‹œíŠ¸
        </button>
        <button id="teamleadModeBtn" style="position: absolute; top: 205px; right: 18px; background: #6B7684; color: white; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 500; z-index: 1000; box-shadow: 0 2px 6px rgba(0,0,0,0.15); border: none; cursor: pointer;">
            íŒ€ì¥
        </button>

    </div>

    <!-- ì„¤ì •ì€ APIì—ì„œ ë™ì ìœ¼ë¡œ ë¡œë“œ -->
    <!-- ìŠˆí¼ë² ì´ìŠ¤ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let map;
        let supabaseClient; // Supabase í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤
        let markers = [];
        let properties = [];
        let selectedProperty = null;
        let filteredProperties = [];
        let geocodeCache = {}; // ì§€ì˜¤ì½”ë”© ìºì‹œ
        let lastLoadedRegion = 'gangnam'; // ë§ˆì§€ë§‰ìœ¼ë¡œ ë¡œë“œí•œ ì§€ì—­ ì¶”ì 
        let CONFIG = null; // ì„¤ì • ì •ë³´ (APIì—ì„œ ë¡œë“œ)
        let appInitialized = false; // ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í›„ ì•± ì´ˆê¸°í™” í”Œë˜ê·¸

        // ë¹™ê³  ê¸°ëŠ¥ ê´€ë ¨ ì „ì—­ ë³€ìˆ˜
        let isAdminMode = false; // ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™” ì—¬ë¶€
        let bingoData = []; // ë¹™ê³  í…Œì´ë¸” ë°ì´í„°
        let bingoLinks = new Set(); // ë¹™ê³  ë§¤ë¬¼ ë§í¬ Set (ë¹ ë¥¸ ì¡°íšŒìš©)

        // ì‚¬ìš©ìë³„ ìƒ‰ê¹” íƒœê·¸ ê´€ë ¨ ì „ì—­ ë³€ìˆ˜
        let currentUser = null; // 'wiplus', 'binsheet', null
        let userTagData = []; // ì‚¬ìš©ì_íƒœê·¸ í…Œì´ë¸” ë°ì´í„°
        let userTagMap = new Map(); // ë§í¬ â†’ ìƒ‰ê¹” (ë¹ ë¥¸ ì¡°íšŒ)
        let pendingUserType = null; // ë¡œê·¸ì¸ ì‹œë„ ì¤‘ì¸ ì‚¬ìš©ì íƒ€ì…

        // íŒ€ì¥ ì¶”ì²œ ê´€ë ¨ ì „ì—­ ë³€ìˆ˜
        let isTeamleadMode = false; // íŒ€ì¥ ë¡œê·¸ì¸ ìƒíƒœ
        let recommendData = []; // ì¶”ì²œ ë°ì´í„° ë°°ì—´
        let recommendLinks = new Set(); // ì¶”ì²œ ë§í¬ Set (ë¹ ë¥¸ ì¡°íšŒ)

        const USER_PASSWORDS = {
            'wiplus': '1231',
            'binsheet': '1213',
            'teamlead': '159'  // íŒ€ì¥ ë¹„ë°€ë²ˆí˜¸
        };

        const TAG_COLORS = {
            'red': { bg: '#FF4444', emoji: 'ğŸ”´', name: 'ë¹¨ê°•' },
            'orange': { bg: '#FF9800', emoji: 'ğŸŸ ', name: 'ì£¼í™©' },
            'purple': { bg: '#9C27B0', emoji: 'ğŸŸ£', name: 'ë³´ë¼' },
            'green': { bg: '#4CAF50', emoji: 'ğŸŸ¢', name: 'ì´ˆë¡' }
        };

        // ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸
        const DEFAULT_PASSWORD = 'ejxkqdnjs1';
        // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸(ê³ ì •)
        const ADMIN_PASSWORD = '6045';
        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¹„ë°€ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
        function getPagePassword() {
            return localStorage.getItem('page_password') || DEFAULT_PASSWORD;
        }
        // ë¹„ë°€ë²ˆí˜¸ ì €ì¥
        function setPagePassword(newPw) {
            localStorage.setItem('page_password', newPw);
        }

        // ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ì²˜ë¦¬
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('passwordInput');
            const submit = document.getElementById('passwordSubmit');
            const errorDiv = document.getElementById('passwordError');
            const changeBtn = document.getElementById('changePasswordBtn');
            const changeBox = document.getElementById('changePasswordBox');
            const oldPwInput = document.getElementById('oldPasswordInput');
            const newPwInput = document.getElementById('newPasswordInput');
            const submitChange = document.getElementById('submitChangePassword');
            const cancelChange = document.getElementById('cancelChangePassword');
            const changeError = document.getElementById('changePasswordError');

            function tryAuth() {
                if (input.value === getPagePassword()) {
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                    // ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ì„±ê³µ í›„ ì•± ì´ˆê¸°í™”
                    if (!appInitialized) {
                        appInitialized = true;
                        console.log('ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ì„±ê³µ - ì•± ì´ˆê¸°í™” ì‹œì‘');
                        initializeApp();
                    }
                } else {
                    errorDiv.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    input.value = '';
                    input.focus();
                }
            }
            submit.onclick = tryAuth;
            input.onkeydown = function(e) { if (e.key === 'Enter') tryAuth(); };
            input.focus();
            document.body.style.overflow = 'hidden';

            // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ UI
            changeBtn.onclick = function() {
                changeBox.style.display = 'block';
                oldPwInput.value = '';
                newPwInput.value = '';
                changeError.textContent = '';
                oldPwInput.focus();
            };
            cancelChange.onclick = function() {
                changeBox.style.display = 'none';
            };
            submitChange.onclick = function() {
                const adminPw = oldPwInput.value;
                const newPw = newPwInput.value;
                if (!adminPw || !newPw) {
                    changeError.textContent = 'ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.';
                    return;
                }
                if (adminPw !== ADMIN_PASSWORD) {
                    changeError.textContent = 'ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    return;
                }
                setPagePassword(newPw);
                changeError.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!';
                setTimeout(() => {
                    changeBox.style.display = 'none';
                    errorDiv.textContent = '';
                }, 1200);
            };
        });

        // ê´€ë¦¬ì ëª¨ë“œ ë¹„ë°€ë²ˆí˜¸
        const ADMIN_MODE_PASSWORD = '6045';

        // ê´€ë¦¬ì ëª¨ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            const adminModeBtn = document.getElementById('adminModeBtn');
            const adminModal = document.getElementById('adminModal');
            const adminPasswordInput = document.getElementById('adminPasswordInput');
            const adminSubmitBtn = document.getElementById('adminSubmitBtn');
            const adminCancelBtn = document.getElementById('adminCancelBtn');
            const adminError = document.getElementById('adminError');

            // ê´€ë¦¬ì ë²„íŠ¼ í´ë¦­
            adminModeBtn.addEventListener('click', function() {
                if (isAdminMode) {
                    // ê´€ë¦¬ì ëª¨ë“œ í•´ì œ
                    isAdminMode = false;
                    updateAdminModeUI();
                    updateStatus('ê´€ë¦¬ì ëª¨ë“œ í•´ì œë¨');
                } else {
                    // ê´€ë¦¬ì ì¸ì¦ ëª¨ë‹¬ í‘œì‹œ
                    adminModal.style.display = 'flex';
                    adminPasswordInput.value = '';
                    adminError.textContent = '';
                    adminPasswordInput.focus();
                }
            });

            // ê´€ë¦¬ì ì¸ì¦ ì²˜ë¦¬
            function tryAdminAuth() {
                if (adminPasswordInput.value === ADMIN_MODE_PASSWORD) {
                    isAdminMode = true;
                    adminModal.style.display = 'none';
                    updateAdminModeUI();
                    updateStatus('ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”ë¨ - ë³„í‘œë¥¼ í´ë¦­í•´ì„œ ë¹™ê³ ì— ì¶”ê°€í•˜ì„¸ìš”');
                } else {
                    adminError.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    adminPasswordInput.value = '';
                    adminPasswordInput.focus();
                }
            }

            adminSubmitBtn.addEventListener('click', tryAdminAuth);
            adminPasswordInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') tryAdminAuth();
            });
            adminCancelBtn.addEventListener('click', function() {
                adminModal.style.display = 'none';
            });
        });

        // ê´€ë¦¬ì ëª¨ë“œ UI ì—…ë°ì´íŠ¸
        function updateAdminModeUI() {
            const btn = document.getElementById('adminModeBtn');
            if (isAdminMode) {
                btn.style.background = '#FFD700';
                btn.style.color = '#333';
                btn.textContent = 'ê´€ë¦¬ì ON';
            } else {
                btn.style.background = '#6B7684';
                btn.style.color = 'white';
                btn.textContent = 'ê´€ë¦¬ì';
            }
        }

        // ì‚¬ìš©ì ë¡œê·¸ì¸ ëª¨ë‹¬ ë° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        document.addEventListener('DOMContentLoaded', function() {
            const userModal = document.getElementById('userModal');
            const userModalTitle = document.getElementById('userModalTitle');
            const userPasswordInput = document.getElementById('userPasswordInput');
            const userSubmitBtn = document.getElementById('userSubmitBtn');
            const userCancelBtn = document.getElementById('userCancelBtn');
            const userError = document.getElementById('userError');
            const wiplusModeBtn = document.getElementById('wiplusModeBtn');
            const binsheetModeBtn = document.getElementById('binsheetModeBtn');

            // ìœ„í”ŒëŸ¬ìŠ¤ ë²„íŠ¼ í´ë¦­
            wiplusModeBtn.addEventListener('click', function() {
                if (currentUser === 'wiplus') {
                    // ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœ â†’ ë¡œê·¸ì•„ì›ƒ
                    logoutUser();
                } else {
                    // ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
                    showUserLoginModal('wiplus');
                }
            });

            // ë¹ˆì‹œíŠ¸ ë²„íŠ¼ í´ë¦­
            binsheetModeBtn.addEventListener('click', function() {
                if (currentUser === 'binsheet') {
                    logoutUser();
                } else {
                    showUserLoginModal('binsheet');
                }
            });

            // íŒ€ì¥ ë²„íŠ¼ í´ë¦­
            const teamleadModeBtn = document.getElementById('teamleadModeBtn');
            teamleadModeBtn.addEventListener('click', function() {
                if (isTeamleadMode) {
                    logoutTeamlead();
                } else {
                    showUserLoginModal('teamlead');
                }
            });

            userSubmitBtn.addEventListener('click', tryUserAuth);
            userPasswordInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') tryUserAuth();
            });
            userCancelBtn.addEventListener('click', function() {
                userModal.style.display = 'none';
            });
        });

        // ì‚¬ìš©ì ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
        function showUserLoginModal(userType) {
            pendingUserType = userType;
            const modal = document.getElementById('userModal');
            const title = document.getElementById('userModalTitle');
            const input = document.getElementById('userPasswordInput');
            const error = document.getElementById('userError');

            // ì‚¬ìš©ì íƒ€ì…ë³„ ìƒ‰ìƒ ì„¤ì •
            let titleText, titleColor;
            if (userType === 'wiplus') {
                titleText = 'ìœ„í”ŒëŸ¬ìŠ¤ ì¸ì¦';
                titleColor = '#4CAF50';
            } else if (userType === 'binsheet') {
                titleText = 'ë¹ˆì‹œíŠ¸ ì¸ì¦';
                titleColor = '#2196F3';
            } else if (userType === 'teamlead') {
                titleText = 'íŒ€ì¥ ì¸ì¦';
                titleColor = '#E91E63';
            }

            title.textContent = titleText;
            title.style.color = titleColor;
            input.style.borderColor = titleColor;
            input.value = '';
            error.textContent = '';
            modal.style.display = 'flex';
            input.focus();
        }

        // ì‚¬ìš©ì ì¸ì¦ ì²˜ë¦¬
        async function tryUserAuth() {
            const input = document.getElementById('userPasswordInput');
            const error = document.getElementById('userError');
            const modal = document.getElementById('userModal');

            if (input.value === USER_PASSWORDS[pendingUserType]) {
                modal.style.display = 'none';

                // íŒ€ì¥ ë¡œê·¸ì¸ ì²˜ë¦¬
                if (pendingUserType === 'teamlead') {
                    isTeamleadMode = true;
                    updateTeamleadModeUI();
                    await loadRecommendData();
                    updateStatus('íŒ€ì¥ ëª¨ë“œ í™œì„±í™”ë¨');
                } else {
                    // ìœ„í”ŒëŸ¬ìŠ¤/ë¹ˆì‹œíŠ¸ ë¡œê·¸ì¸ ì²˜ë¦¬
                    currentUser = pendingUserType;
                    updateUserModeUI();
                    await loadUserTags();
                    document.getElementById('colorFilterRow').style.display = 'inline';
                    updateStatus(`${currentUser === 'wiplus' ? 'ìœ„í”ŒëŸ¬ìŠ¤' : 'ë¹ˆì‹œíŠ¸'} ëª¨ë“œ í™œì„±í™”ë¨`);
                }

                // ë§ˆì»¤ ì¬í‘œì‹œ (ìƒ‰ê¹”/ì¶”ì²œ í‘œì‹œ ìœ„í•´)
                if (filteredProperties.length > 0) {
                    displayMarkersOnMap();
                }
            } else {
                error.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                input.value = '';
                input.focus();
            }
        }

        // ì‚¬ìš©ì ë¡œê·¸ì•„ì›ƒ
        function logoutUser() {
            currentUser = null;
            userTagData = [];
            userTagMap.clear();
            updateUserModeUI();
            document.getElementById('colorFilterRow').style.display = 'none';
            // ìƒ‰ê¹” í•„í„° ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            document.getElementById('redFilterCheckbox').checked = false;
            document.getElementById('orangeFilterCheckbox').checked = false;
            document.getElementById('purpleFilterCheckbox').checked = false;
            document.getElementById('greenFilterCheckbox').checked = false;
            updateStatus('ì‚¬ìš©ì ë¡œê·¸ì•„ì›ƒë¨');
            if (filteredProperties.length > 0) {
                displayMarkersOnMap();
            }
        }

        // ì‚¬ìš©ì ëª¨ë“œ UI ì—…ë°ì´íŠ¸
        function updateUserModeUI() {
            const wiplusBtn = document.getElementById('wiplusModeBtn');
            const binsheetBtn = document.getElementById('binsheetModeBtn');

            if (currentUser === 'wiplus') {
                wiplusBtn.style.background = '#4CAF50';
                wiplusBtn.textContent = 'ìœ„í”ŒëŸ¬ìŠ¤ ON';
                binsheetBtn.style.background = '#6B7684';
                binsheetBtn.textContent = 'ë¹ˆì‹œíŠ¸';
            } else if (currentUser === 'binsheet') {
                wiplusBtn.style.background = '#6B7684';
                wiplusBtn.textContent = 'ìœ„í”ŒëŸ¬ìŠ¤';
                binsheetBtn.style.background = '#2196F3';
                binsheetBtn.textContent = 'ë¹ˆì‹œíŠ¸ ON';
            } else {
                wiplusBtn.style.background = '#6B7684';
                wiplusBtn.textContent = 'ìœ„í”ŒëŸ¬ìŠ¤';
                binsheetBtn.style.background = '#6B7684';
                binsheetBtn.textContent = 'ë¹ˆì‹œíŠ¸';
            }
        }

        // íŒ€ì¥ ëª¨ë“œ UI ì—…ë°ì´íŠ¸
        function updateTeamleadModeUI() {
            const teamleadBtn = document.getElementById('teamleadModeBtn');
            if (isTeamleadMode) {
                teamleadBtn.style.background = '#E91E63';
                teamleadBtn.textContent = 'íŒ€ì¥ ON';
            } else {
                teamleadBtn.style.background = '#6B7684';
                teamleadBtn.textContent = 'íŒ€ì¥';
            }
        }

        // íŒ€ì¥ ë¡œê·¸ì•„ì›ƒ
        function logoutTeamlead() {
            isTeamleadMode = false;
            recommendData = [];
            recommendLinks.clear();
            updateTeamleadModeUI();
            updateStatus('íŒ€ì¥ ë¡œê·¸ì•„ì›ƒë¨');
            if (filteredProperties.length > 0) {
                displayMarkersOnMap();
            }
        }

        // ì¶”ì²œ ë°ì´í„° ë¡œë“œ
        async function loadRecommendData() {
            try {
                updateStatus('ì¶”ì²œ ë°ì´í„° ë¡œë“œ ì¤‘...');
                const { data, error } = await supabaseClient
                    .from('ì‚¬ìš©ì_íƒœê·¸')
                    .select('*')
                    .eq('user_type', 'teamlead')
                    .eq('color', 'recommend');

                if (error) {
                    console.warn('ì¶”ì²œ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                    recommendData = [];
                } else {
                    recommendData = data || [];
                }

                // Set êµ¬ì„± (ë¹ ë¥¸ ì¡°íšŒìš©)
                recommendLinks.clear();
                recommendData.forEach(item => {
                    const link = item['ë§í¬(URL)'];
                    if (link) recommendLinks.add(link);
                });

                console.log(`[DEBUG] ì¶”ì²œ ë°ì´í„° ë¡œë“œ: ${recommendData.length}ê°œ`);
            } catch (error) {
                console.error('ì¶”ì²œ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì¶”ì²œ í† ê¸€
        async function toggleRecommend(link) {
            if (!isTeamleadMode) {
                alert('íŒ€ì¥ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            try {
                if (recommendLinks.has(link)) {
                    // ì¶”ì²œ í•´ì œ
                    const { error } = await supabaseClient
                        .from('ì‚¬ìš©ì_íƒœê·¸')
                        .delete()
                        .eq('"ë§í¬(URL)"', link)
                        .eq('user_type', 'teamlead')
                        .eq('color', 'recommend');

                    if (error) throw error;
                    recommendLinks.delete(link);
                    updateStatus('ì¶”ì²œ í•´ì œë¨');
                    updateMarkerIcon(link);  // ë§ˆì»¤ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                } else {
                    // ì¶”ì²œ ì¶”ê°€
                    const { error } = await supabaseClient
                        .from('ì‚¬ìš©ì_íƒœê·¸')
                        .insert({
                            'ë§í¬(URL)': link,
                            user_type: 'teamlead',
                            color: 'recommend'
                        });

                    if (error) throw error;
                    recommendLinks.add(link);
                    updateStatus('ì¶”ì²œ ì¶”ê°€ë¨');
                    updateMarkerIcon(link);  // ë§ˆì»¤ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                }
                return true;
            } catch (error) {
                console.error('ì¶”ì²œ í† ê¸€ ì˜¤ë¥˜:', error);
                updateStatus('ì¶”ì²œ ì²˜ë¦¬ ì‹¤íŒ¨');
                return false;
            }
        }

        // ì¸í¬ìœˆë„ìš°ì—ì„œ ì¶”ì²œ í† ê¸€
        window.toggleRecommendFromInfo = async function(link, el) {
            if (!isTeamleadMode) {
                alert('íŒ€ì¥ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            const result = await toggleRecommend(link);
            if (result && el) {
                // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                const isNowRecommend = recommendLinks.has(link);
                el.style.color = isNowRecommend ? '#E91E63' : '#ccc';
                el.title = isNowRecommend ? 'ì¶”ì²œ í•´ì œ' : 'ì¶”ì²œ';
            }
        };

        // ì‚¬ìš©ì íƒœê·¸ ë°ì´í„° ë¡œë“œ
        async function loadUserTags() {
            if (!currentUser) return;

            try {
                updateStatus('ì‚¬ìš©ì íƒœê·¸ ë¡œë“œ ì¤‘...');
                const { data, error } = await supabaseClient
                    .from('ì‚¬ìš©ì_íƒœê·¸')
                    .select('*')
                    .eq('user_type', currentUser);

                if (error) {
                    console.warn('ì‚¬ìš©ì íƒœê·¸ ë¡œë“œ ì˜¤ë¥˜:', error);
                    userTagData = [];
                } else {
                    userTagData = data || [];
                }

                // Map êµ¬ì„± (ë¹ ë¥¸ ì¡°íšŒìš©)
                userTagMap.clear();
                userTagData.forEach(item => {
                    const link = item['ë§í¬(URL)'];
                    if (link) userTagMap.set(link, item.color);
                });

                console.log(`[DEBUG] ì‚¬ìš©ì íƒœê·¸ ë¡œë“œ: ${userTagData.length}ê°œ`);
            } catch (error) {
                console.error('ì‚¬ìš©ì íƒœê·¸ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ìƒ‰ê¹” íƒœê·¸ í† ê¸€
        async function toggleColorTag(link, color) {
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            // ë¹™ê³  ë§¤ë¬¼ë§Œ ìƒ‰ê¹” íƒœê·¸ ê°€ëŠ¥
            if (!bingoLinks.has(link)) {
                alert('ë¹™ê³  ë§¤ë¬¼ì—ë§Œ ìƒ‰ê¹” íƒœê·¸ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                const currentColor = userTagMap.get(link);

                if (currentColor === color) {
                    // ê°™ì€ ìƒ‰ í´ë¦­ â†’ íƒœê·¸ í•´ì œ
                    const { error } = await supabaseClient
                        .from('ì‚¬ìš©ì_íƒœê·¸')
                        .delete()
                        .eq('"ë§í¬(URL)"', link)
                        .eq('user_type', currentUser);

                    if (error) throw error;
                    userTagMap.delete(link);
                    updateStatus(`${TAG_COLORS[color].name} íƒœê·¸ í•´ì œë¨`);
                    updateMarkerIcon(link);  // ë§ˆì»¤ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                } else {
                    // ë‹¤ë¥¸ ìƒ‰ í´ë¦­ â†’ UPSERT
                    const { error } = await supabaseClient
                        .from('ì‚¬ìš©ì_íƒœê·¸')
                        .upsert({
                            'ë§í¬(URL)': link,
                            user_type: currentUser,
                            color: color
                        }, { onConflict: '"ë§í¬(URL)",user_type' });

                    if (error) throw error;
                    userTagMap.set(link, color);
                    updateStatus(`${TAG_COLORS[color].name} íƒœê·¸ ì¶”ê°€ë¨`);
                    updateMarkerIcon(link);  // ë§ˆì»¤ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                }
            } catch (error) {
                console.error('ìƒ‰ê¹” íƒœê·¸ í† ê¸€ ì˜¤ë¥˜:', error);
                alert('ìƒ‰ê¹” íƒœê·¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ' + error.message);
            }
        }

        window.toggleColorTag = toggleColorTag;

        // ê°œë³„ ë§ˆì»¤ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ìƒ‰ê¹” ë³€ê²½ ì‹œ ì¦‰ì‹œ ë°˜ì˜)
        function updateMarkerIcon(link) {
            // í•´ë‹¹ ë§í¬ë¥¼ ê°€ì§„ ë§ˆì»¤ ì°¾ê¸°
            const marker = markers.find(m => m.links && m.links.includes(link));
            if (!marker) return;

            // ë§ˆì»¤ì˜ propertiesGroup ì •ë³´ë¡œ ìƒ‰ìƒ ê²°ì •
            const propertiesGroup = marker.propertiesGroup || [];
            const propertyCount = propertiesGroup.length;

            const hasBingo = propertiesGroup.some(p => {
                const pLink = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                return p.isBingo || (pLink && bingoLinks.has(pLink));
            });

            let userColor = null;
            if (currentUser) {
                for (const p of propertiesGroup) {
                    const pLink = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                    const tagColor = userTagMap.get(pLink);
                    if (tagColor) {
                        userColor = TAG_COLORS[tagColor].bg;
                        break;
                    }
                }
            }

            // ì¶”ì²œ ìƒíƒœ í™•ì¸
            const hasRecommend = propertiesGroup.some(p => {
                const pLink = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                return pLink && recommendLinks.has(pLink);
            });

            // ë§ˆì»¤ ìŠ¤íƒ€ì¼ ê²°ì •
            let markerStyle, textColor;
            if (hasBingo && userColor) {
                markerStyle = `background: linear-gradient(to right, #FFD700 50%, ${userColor} 50%);`;
                textColor = '#333';
            } else if (hasBingo && hasRecommend) {
                // ë¹™ê³  + ì¶”ì²œ: ê³¨ë“œì™€ í•‘í¬ ë°˜ë°˜
                markerStyle = 'background: linear-gradient(to right, #FFD700 50%, #E91E63 50%);';
                textColor = '#333';
            } else if (hasBingo) {
                markerStyle = 'background: #FFD700;';
                textColor = '#333';
            } else if (hasRecommend) {
                // ì¶”ì²œë§Œ: í•‘í¬ í…Œë‘ë¦¬
                markerStyle = 'background: #3182F6; border: 3px solid #E91E63 !important;';
                textColor = 'white';
            } else if (propertyCount > 1) {
                markerStyle = 'background: #FF6B35;';
                textColor = 'white';
            } else {
                markerStyle = 'background: #3182F6;';
                textColor = 'white';
            }

            // ë§ˆì»¤ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            const displayText = marker.getTitle();
            marker.setIcon({
                content: `<div style="${markerStyle} color: ${textColor}; padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.18); max-width:180px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${displayText}</div>`,
                size: new naver.maps.Size(30, 30),
                anchor: new naver.maps.Point(15, 15)
            });
        }

        // ë¹™ê³  í† ê¸€ í•¨ìˆ˜ (ë³„í‘œ í´ë¦­ ì‹œ í˜¸ì¶œ)
        async function toggleBingo(property) {
            if (!isAdminMode) {
                alert('ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ ë¹™ê³ ë¥¼ ì¶”ê°€/í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            const link = property['ë§í¬(URL)'] || property.ë§í¬ || property.url || property.URL;
            if (!link) {
                alert('ë§í¬ê°€ ì—†ëŠ” ë§¤ë¬¼ì€ ë¹™ê³ ì— ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                if (bingoLinks.has(link)) {
                    // ë¹™ê³  í•´ì œ: í…Œì´ë¸”ì—ì„œ DELETE
                    updateStatus('ë¹™ê³  í•´ì œ ì¤‘...');
                    const { error } = await supabaseClient
                        .from('ë¹™ê³ ')
                        .delete()
                        .eq('"ë§í¬(URL)"', link);

                    if (error) throw error;

                    bingoLinks.delete(link);
                    // bingoDataì—ì„œë„ ì œê±°
                    bingoData = bingoData.filter(item => {
                        const itemLink = item['ë§í¬(URL)'] || item.ë§í¬ || item.url || item.URL;
                        return itemLink !== link;
                    });
                    // propertiesì—ì„œ isBingo í”Œë˜ê·¸ ì œê±°
                    properties.forEach(p => {
                        const pLink = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                        if (pLink === link) p.isBingo = false;
                    });

                    updateStatus('ë¹™ê³  í•´ì œë¨');
                    console.log(`[DEBUG] ë¹™ê³  í•´ì œ: ${link}`);
                } else {
                    // ë¹™ê³  ì¶”ê°€: ë§¤ë¬¼ ë°ì´í„° ì „ì²´ë¥¼ ë¹™ê³  í…Œì´ë¸”ì— INSERT
                    updateStatus('ë¹™ê³  ì¶”ê°€ ì¤‘...');
                    const insertData = {
                        ì£¼ì†Œ: property.ì£¼ì†Œ || '',
                        ê±°ë˜ë°©ì‹: property.ê±°ë˜ë°©ì‹ || '',
                        ì „ì„¸ê¸ˆ: property.ì „ì„¸ê¸ˆ || '',
                        ì›”ì„¸: property.ì›”ì„¸ || '',
                        ê³µí´: property.ê³µí´ || '',
                        ì˜¨í•˜: property.ì˜¨í•˜ || '',
                        ê° ë§¤: property.ê° ë§¤ || '',
                        'ë§í¬(URL)': link,
                        'ë“±ë¡/í™•ì¸ì¼': property['ë“±ë¡/í™•ì¸ì¼'] || property.í™•ì¸ì¼ || property.ë“±ë¡ì¼ || ''
                    };

                    const { data, error } = await supabaseClient
                        .from('ë¹™ê³ ')
                        .insert(insertData)
                        .select();

                    if (error) throw error;

                    bingoLinks.add(link);
                    // bingoDataì— ì¶”ê°€
                    const newBingo = { ...insertData, isBingo: true };
                    if (data && data[0]) newBingo.id = data[0].id;
                    bingoData.push(newBingo);
                    // propertiesì—ì„œ isBingo í”Œë˜ê·¸ ì¶”ê°€
                    properties.forEach(p => {
                        const pLink = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                        if (pLink === link) p.isBingo = true;
                    });

                    updateStatus('ë¹™ê³  ì¶”ê°€ë¨');
                    console.log(`[DEBUG] ë¹™ê³  ì¶”ê°€: ${link}`);
                }

                // ë§ˆì»¤ ì¬ìƒì„± ì œê±° - UIëŠ” toggleBingoFromInfoì—ì„œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë¨
                // ë§ˆì»¤ ìƒ‰ìƒ ë³€ê²½ì€ ë‹¤ìŒ ê²€ìƒ‰/í•„í„° ì‹œ ë°˜ì˜ë¨ (ì„±ëŠ¥ ìµœì í™”)
            } catch (error) {
                console.error('ë¹™ê³  í† ê¸€ ì˜¤ë¥˜:', error);
                alert('ë¹™ê³  ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                updateStatus('ë¹™ê³  ì²˜ë¦¬ ì˜¤ë¥˜');
            }
        }

        // ì „ì—­ì—ì„œ toggleBingo í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡
        window.toggleBingo = toggleBingo;

        // ì¸í¬ìœˆë„ìš°ì—ì„œ ë³„í‘œ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        window.toggleBingoFromInfo = async function(index, link, element) {
            // ë§í¬ë¡œ ë§¤ë¬¼ ì°¾ê¸°
            const property = filteredProperties.find(p => {
                const pLink = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                return pLink === link;
            }) || properties.find(p => {
                const pLink = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                return pLink === link;
            });

            if (!property) {
                alert('ë§¤ë¬¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            await toggleBingo(property);

            // ë³„í‘œ ìŠ¤íƒ€ì¼ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            const isBingoNow = bingoLinks.has(link);
            if (element) {
                element.style.color = isBingoNow ? '#FFD700' : '#ccc';
                element.style.textShadow = isBingoNow ? '0 0 3px #FFA500' : 'none';
                element.title = isBingoNow ? 'ë¹™ê³  í•´ì œ' : 'ë¹™ê³  ì¶”ê°€';

                // ë¶€ëª¨ ì¹´ë“œ ë°°ê²½ìƒ‰ë„ ì—…ë°ì´íŠ¸
                const card = element.closest('div[style*="border"]');
                if (card) {
                    card.style.background = isBingoNow ? '#FFFBEB' : '#F9FAFB';
                    card.style.borderColor = isBingoNow ? '#FFD700' : '#E5E8EB';
                }
            }
        };

        // ì¸í¬ìœˆë„ìš°ì—ì„œ ìƒ‰ê¹” ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        window.toggleColorTagFromInfo = async function(link, color, element) {
            await toggleColorTag(link, color);

            // ìƒ‰ê¹” ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            const currentColor = userTagMap.get(link);
            const parent = element.parentElement;
            if (parent) {
                const buttons = parent.querySelectorAll('span[onclick*="toggleColorTagFromInfo"]');
                buttons.forEach(btn => {
                    const btnColor = btn.getAttribute('onclick').match(/'([^']+)', '([^']+)'/)?.[2];
                    btn.style.opacity = (currentColor === btnColor) ? '1' : '0.4';
                });
            }
        };

        // ì§€ì˜¤ì½”ë”© ìºì‹œ ë¡œë“œ
        function loadGeocodeCache() {
            try {
                const cached = localStorage.getItem('geocodeCache');
                if (cached) {
                    geocodeCache = JSON.parse(cached);
                    console.log(`ì§€ì˜¤ì½”ë”© ìºì‹œ ${Object.keys(geocodeCache).length}ê°œ ë¡œë“œë¨`);
                }
            } catch (error) {
                console.warn('ì§€ì˜¤ì½”ë”© ìºì‹œ ë¡œë“œ ì‹¤íŒ¨:', error);
                geocodeCache = {};
            }
        }

        // ì§€ì˜¤ì½”ë”© ìºì‹œ ì €ì¥
        function saveGeocodeCache() {
            try {
                localStorage.setItem('geocodeCache', JSON.stringify(geocodeCache));
            } catch (error) {
                console.warn('ì§€ì˜¤ì½”ë”© ìºì‹œ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // ì´ˆê¸°í™”ëŠ” ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ í›„ì— ìˆ˜í–‰
            document.getElementById('search-btn').addEventListener('click', onFilterSearch);
            document.getElementById('filterToggleBtn').addEventListener('click', function() {
                const filterContainer = document.getElementById('filterContainer');
                const btn = document.getElementById('filterToggleBtn');
                if (filterContainer.classList.contains('collapsed')) {
                    filterContainer.classList.remove('collapsed');
                    btn.textContent = 'í•„í„° ì ‘ê¸°';
                    btn.classList.remove('collapsed');
                } else {
                    filterContainer.classList.add('collapsed');
                    btn.textContent = 'í•„í„° í¼ì¹˜ê¸°';
                    btn.classList.add('collapsed');
                }
            });
            document.getElementById('reset-btn').addEventListener('click', function() {
                // í•„í„° ì…ë ¥ê°’ ì´ˆê¸°í™”
                document.getElementById('search-input').value = '';
                document.querySelector('input[name="type"][value="villa"]').checked = true;
                // ì§€ì—­ ì²´í¬ë°•ìŠ¤ ëª¨ë‘ í•´ì œ
                document.querySelectorAll('input[name="region"]').forEach(cb => cb.checked = false);
                // êµ¬ë¶„ ì²´í¬ë°•ìŠ¤ ëª¨ë‘ í•´ì œ
                document.querySelectorAll('input[name="status"]').forEach(cb => cb.checked = false);
                // ë§¤ë¬¼ìƒíƒœ ì²´í¬ë°•ìŠ¤ ëª¨ë‘ í•´ì œ
                document.querySelectorAll('input[name="category"]').forEach(cb => cb.checked = false);
                document.getElementById('singleOnlyCheckbox').checked = false; // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                document.getElementById('bingoOnlyCheckbox').checked = false; // ë¹™ê³  ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                document.getElementById('recommendOnlyCheckbox').checked = false; // ì¶”ì²œ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                document.getElementById('deposit-min').value = '';
                document.getElementById('deposit-max').value = '';
                document.getElementById('rent-min').value = '';
                document.getElementById('rent-max').value = '';
                document.querySelector('input[name="room"][value=""]').checked = true;
                document.querySelector('input[name="date"][value=""]').checked = true;
                
                // í•„í„° ì´ˆê¸°í™” ì‹œ ë§¤ë¬¼ì„ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                filteredProperties = [];
                displayMarkersOnMap();
                updateStatus('í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
                document.getElementById('totalCount').textContent = 'ì´ ë§¤ë¬¼: 0ê°œ';
                document.getElementById('shownCount').textContent = 'í‘œì‹œ ì¤‘: 0ê°œ';
            });
        });

        // ë„¤ì´ë²„ ì§€ë„ API ë™ì  ë¡œë“œ
        function loadNaverMapAPI() {
            return new Promise((resolve, reject) => {
                if (window.naver && window.naver.maps) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = `https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=${CONFIG.CLIENT_ID}&submodules=geocoder`;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // ì„¤ì • ì •ë³´ ë¡œë“œ
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                if (!response.ok) {
                    throw new Error('ì„¤ì • ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                CONFIG = await response.json();
                console.log('ì„¤ì • ì •ë³´ ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
                throw new Error('ì„¤ì • ì •ë³´ ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
            }
        }

        async function initializeApp() {
            try {
                console.log('initializeApp() í˜¸ì¶œë¨');
                updateStatus('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...');
                
                // ì„¤ì • ì •ë³´ ë¡œë“œ
                updateStatus('ì„¤ì • ì •ë³´ ë¡œë“œ ì¤‘...');
                console.log('ì„¤ì • ì •ë³´ ë¡œë“œ ì‹œì‘');
                await loadConfig();
                console.log('ì„¤ì • ì •ë³´ ë¡œë“œ ì™„ë£Œ:', CONFIG);
                
                // ì§€ì˜¤ì½”ë”© ìºì‹œ ë¡œë“œ
                loadGeocodeCache();
                
                // ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ
                updateStatus('ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì¤‘...');
                await loadNaverMapAPI();
                supabaseClient = window.supabase.createClient(
                    CONFIG.SUPABASE.URL,
                    CONFIG.SUPABASE.ANON_KEY
                );
                
                // ìŠˆí¼ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
                updateStatus('ìŠˆí¼ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');
                try {
                    // ë¨¼ì € ì „ì²´ ê°œìˆ˜ í™•ì¸
                    const { count, error: countError } = await supabaseClient
                        .from('ë„¤ì´ë²„ì§€ë„')
                        .select('*', { count: 'exact', head: true });
                    
                    if (countError) {
                        console.error('ìŠˆí¼ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜:', countError);
                        showError('ìŠˆí¼ë² ì´ìŠ¤ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + countError.message);
                        return;
                    }
                    
                    console.log('ìŠˆí¼ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ');
                    console.log('í˜„ì¬ Supabaseì— ì €ì¥ëœ ì´ ë§¤ë¬¼ ê°œìˆ˜:', count);
                    updateStatus(`ìŠˆí¼ë² ì´ìŠ¤ ì—°ê²° í™•ì¸ë¨ (ì´ ${count}ê°œ ë§¤ë¬¼)`);
                    
                    if (count === 0) {
                        console.warn('âš ï¸ Supabaseì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤! í¬ë¡¤ëŸ¬ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.');
                        showError('âš ï¸ Supabaseì— ë§¤ë¬¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. í¬ë¡¤ëŸ¬ë¥¼ ì‹¤í–‰í•´ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”.');
                    }
                } catch (error) {
                    console.error('ìŠˆí¼ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                    showError('ìŠˆí¼ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message);
                    return;
                }
                
                await initializeMap();
                // ì§€ë„ ì´ˆê¸°í™”ê°€ ëë‚˜ë©´ loading ë©”ì‹œì§€ ìˆ¨ê¹€
                hideLoading();
                await loadProperties();
                updateStatus('ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                showError('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function initializeMap() {
            return new Promise((resolve, reject) => {
                try {
                    map = new naver.maps.Map('map', {
                        center: new naver.maps.LatLng(CONFIG.NAVER_MAP.CENTER.lat, CONFIG.NAVER_MAP.CENTER.lng),
                        zoom: CONFIG.NAVER_MAP.ZOOM,
                        mapTypeControl: true,
                        mapTypeControlOptions: {
                            style: naver.maps.MapTypeControlStyle.BUTTON,
                            position: naver.maps.Position.TOP_LEFT
                        },
                        zoomControl: true,
                        zoomControlOptions: {
                            style: naver.maps.ZoomControlStyle.SMALL,
                            position: naver.maps.Position.TOP_RIGHT
                        }
                    });
                    
                    // ì§€ë„ í´ë¦­ ì‹œ ëª¨ë“  ì •ë³´ì°½ ë‹«ê¸°
                    naver.maps.Event.addListener(map, 'click', function() {
                        markers.forEach(m => {
                            if (m.infoWindow && m.isOpen) {
                                m.infoWindow.close();
                                m.isOpen = false;
                            }
                        });
                    });
                    
                    updateStatus('ì§€ë„ ë¡œë“œ ì™„ë£Œ');
                    resolve();
                } catch (error) {
                    reject(error);
                }
            });
        }

        async function loadProperties() {
            try {
                updateStatus('ë§¤ë¬¼ ë°ì´í„° ë¡œë“œ ì¤‘...');

                // 1. ë„¤ì´ë²„ì§€ë„ í…Œì´ë¸” ë¡œë“œ
                let tableName = 'ë„¤ì´ë²„ì§€ë„';
                console.log(`[DEBUG] ì‚¬ìš©í•  í…Œì´ë¸”: ${tableName}`);

                const { count, error: countError } = await supabaseClient
                    .from(tableName)
                    .select('*', { count: 'exact', head: true });

                if (countError) {
                    console.error(`[DEBUG] ì „ì²´ ê°œìˆ˜ í™•ì¸ ì˜¤ë¥˜:`, countError);
                    throw countError;
                }

                console.log(`[DEBUG] ë„¤ì´ë²„ì§€ë„ ë°ì´í„° ê°œìˆ˜: ${count}ê°œ`);
                const naverMapData = await loadPropertiesSequential(tableName, count);

                // 2. ë¹™ê³  í…Œì´ë¸” ë¡œë“œ
                updateStatus('ë¹™ê³  ë°ì´í„° ë¡œë“œ ì¤‘...');
                const { data: bingoResult, error: bingoError } = await supabaseClient
                    .from('ë¹™ê³ ')
                    .select('*');

                if (bingoError) {
                    console.warn('[DEBUG] ë¹™ê³  í…Œì´ë¸” ë¡œë“œ ì˜¤ë¥˜:', bingoError);
                    bingoData = [];
                } else {
                    bingoData = bingoResult || [];
                }

                console.log(`[DEBUG] ë¹™ê³  ë°ì´í„° ê°œìˆ˜: ${bingoData.length}ê°œ`);

                // 3. ë¹™ê³  ë°ì´í„°ì— isBingo í”Œë˜ê·¸ ì¶”ê°€ ë° bingoLinks Set êµ¬ì„±
                bingoLinks = new Set();
                bingoData.forEach(item => {
                    item.isBingo = true;
                    const link = item['ë§í¬(URL)'] || item.ë§í¬ || item.url || item.URL;
                    if (link) bingoLinks.add(link);
                });

                // 3.5. ì¶”ì²œ ë°ì´í„° ë¡œë“œ (ëª¨ë“  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆìŒ)
                const { data: recommendResult, error: recommendError } = await supabaseClient
                    .from('ì‚¬ìš©ì_íƒœê·¸')
                    .select('*')
                    .eq('user_type', 'teamlead')
                    .eq('color', 'recommend');

                if (recommendError) {
                    console.warn('[DEBUG] ì¶”ì²œ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', recommendError);
                    recommendData = [];
                } else {
                    recommendData = recommendResult || [];
                }

                // recommendLinks Set êµ¬ì„±
                recommendLinks.clear();
                recommendData.forEach(item => {
                    const link = item['ë§í¬(URL)'];
                    if (link) recommendLinks.add(link);
                });

                console.log(`[DEBUG] ì¶”ì²œ ë°ì´í„° ê°œìˆ˜: ${recommendData.length}ê°œ`);

                // 4. ë„¤ì´ë²„ì§€ë„ + ë¹™ê³  í•©ì¹˜ê¸° (ì¤‘ë³µ ì œê±°: ë§í¬ ê¸°ì¤€)
                const uniqueNaverData = naverMapData.filter(item => {
                    const link = item['ë§í¬(URL)'] || item.ë§í¬ || item.url || item.URL;
                    return !link || !bingoLinks.has(link);
                });

                properties = [...uniqueNaverData, ...bingoData];

                console.log(`[DEBUG] ìµœì¢… ë¡œë“œëœ ë§¤ë¬¼ ë°ì´í„°:`, properties.length, 'ê°œ');
                console.log(`[DEBUG] (ë„¤ì´ë²„ì§€ë„: ${uniqueNaverData.length}ê°œ + ë¹™ê³ : ${bingoData.length}ê°œ)`);

                // ì´ˆê¸° ë¡œë“œ ì‹œì—ëŠ” ë§¤ë¬¼ì„ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                filteredProperties = [];
                updateStatus(`ë§¤ë¬¼ ${properties.length}ê°œ ë¡œë“œ ì™„ë£Œ (ë¹™ê³  ${bingoData.length}ê°œ, ì¶”ì²œ ${recommendData.length}ê°œ)`);
                document.getElementById('totalCount').textContent = `ì´ ë§¤ë¬¼: ${properties.length}ê°œ`;
                document.getElementById('shownCount').textContent = `í‘œì‹œ ì¤‘: 0ê°œ`;

                console.log(`[DEBUG] ë§¤ë¬¼ ë¡œë”© ì™„ë£Œ - ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”`);
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                showError('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ìˆœì°¨ ì²˜ë¦¬ ë°©ì‹
        async function loadPropertiesSequential(tableName, totalCount) {
            let allData = [];
            let batchSize = 1000; // Supabase ê¸°ë³¸ ì œí•œ
            let maxCount = 200000; // ìµœëŒ€ 20ë§Œê°œê¹Œì§€ ë¶ˆëŸ¬ì˜¤ê¸° ê°€ëŠ¥
            let lastId = 0;
            let batchCount = 0;
            
            while (allData.length < maxCount && allData.length < totalCount) {
                batchCount++;
                console.log(`[DEBUG] ë°°ì¹˜ ${batchCount} ë¡œë“œ ì¤‘... (í˜„ì¬ ${allData.length}ê°œ, lastId: ${lastId})`);
                
                const { data, error } = await supabaseClient
                    .from(tableName)
                    .select('*')
                    .gt('id', lastId)
                    .order('id', { ascending: true })
                    .limit(batchSize);
                
                if (error) {
                    console.error(`[DEBUG] ë°°ì¹˜ ${batchCount} ë¡œë“œ ì˜¤ë¥˜:`, error);
                    if (allData.length === 0) throw error;
                    else break;
                }
                
                if (!data || data.length === 0) {
                    console.log(`[DEBUG] ë” ì´ìƒ ë°ì´í„° ì—†ìŒ`);
                    break;
                }
                
                console.log(`[DEBUG] ë°°ì¹˜ ${batchCount} ë¡œë“œ ì™„ë£Œ: ${data.length}ê°œ`);
                allData = allData.concat(data);
                lastId = data[data.length - 1].id;
                
                // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
                updateStatus(`ë§¤ë¬¼ ë°ì´í„° ë¡œë“œ ì¤‘... (${allData.length}/${totalCount}ê°œ)`);
                
                // ë°°ì¹˜ ê°„ ì§§ì€ ëŒ€ê¸° (ì„œë²„ ë¶€í•˜ ë°©ì§€)
                if (data.length === batchSize) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                if (data.length < batchSize) break;
            }
            
            return allData;
        }

        // ë³‘ë ¬ ì²˜ë¦¬ ë°©ì‹ (ëŒ€ìš©ëŸ‰ ë°ì´í„°ìš©)
        async function loadPropertiesParallel(tableName, totalCount) {
            const batchSize = 1000;
            const maxConcurrent = 3; // ë™ì‹œ ìš”ì²­ ìˆ˜ ì œí•œ
            const totalBatches = Math.ceil(totalCount / batchSize);
            
            console.log(`[DEBUG] ë³‘ë ¬ ì²˜ë¦¬: ì´ ${totalBatches}ê°œ ë°°ì¹˜, ë™ì‹œ ìš”ì²­ ${maxConcurrent}ê°œ`);
            
            let allData = [];
            let completedBatches = 0;
            
            // ë°°ì¹˜ë³„ ID ë²”ìœ„ ê³„ì‚°
            const batchRanges = [];
            for (let i = 0; i < totalBatches; i++) {
                const startId = i * batchSize;
                const endId = Math.min((i + 1) * batchSize - 1, totalCount - 1);
                batchRanges.push({ startId, endId, batchIndex: i });
            }
            
            // ë³‘ë ¬ë¡œ ë°°ì¹˜ ì²˜ë¦¬
            for (let i = 0; i < totalBatches; i += maxConcurrent) {
                const currentBatches = batchRanges.slice(i, i + maxConcurrent);
                
                console.log(`[DEBUG] ë³‘ë ¬ ë°°ì¹˜ ${i + 1}-${Math.min(i + maxConcurrent, totalBatches)} ì²˜ë¦¬ ì¤‘...`);
                
                const batchPromises = currentBatches.map(async (range) => {
                    try {
                        const { data, error } = await supabaseClient
                            .from(tableName)
                            .select('*')
                            .gte('id', range.startId)
                            .lte('id', range.endId)
                            .order('id', { ascending: true });
                        
                        if (error) {
                            console.error(`[DEBUG] ë°°ì¹˜ ${range.batchIndex + 1} ì˜¤ë¥˜:`, error);
                            return [];
                        }
                        
                        completedBatches++;
                        updateStatus(`ë§¤ë¬¼ ë°ì´í„° ë¡œë“œ ì¤‘... (${completedBatches}/${totalBatches} ë°°ì¹˜ ì™„ë£Œ)`);
                        
                        console.log(`[DEBUG] ë°°ì¹˜ ${range.batchIndex + 1} ì™„ë£Œ: ${data?.length || 0}ê°œ`);
                        return data || [];
                    } catch (error) {
                        console.error(`[DEBUG] ë°°ì¹˜ ${range.batchIndex + 1} ì˜ˆì™¸:`, error);
                        return [];
                    }
                });
                
                const batchResults = await Promise.all(batchPromises);
                batchResults.forEach(data => {
                    allData = allData.concat(data);
                });
                
                // ë°°ì¹˜ ê·¸ë£¹ ê°„ ëŒ€ê¸°
                if (i + maxConcurrent < totalBatches) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }
            
            // ID ìˆœìœ¼ë¡œ ì •ë ¬
            allData.sort((a, b) => a.id - b.id);
            
            return allData;
        }

        // ì£¼ì†Œì—ì„œ ë™ì„ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
        function extractDongFromAddress(address) {
            if (!address) return '';
            
            // ì„œìš¸ì‹œ ê°•ë‚¨êµ¬, ì„œìš¸ì‹œ ì†¡íŒŒêµ¬ ë“± êµ¬ ì •ë³´ ì¶”ì¶œ
            const guMatch = address.match(/ì„œìš¸ì‹œ\s*([ê°€-í£]+êµ¬)/);
            if (guMatch) {
                return guMatch[1];
            }
            
            // ë™ ì •ë³´ ì¶”ì¶œ (ë²ˆì§€ìˆ˜ í¬í•¨ ì£¼ì†Œì—ì„œë„ ë™ ì¶”ì¶œ)
            const dongMatch = address.match(/([ê°€-í£]+ë™)/);
            if (dongMatch) {
                return dongMatch[1];
            }
            
            return '';
        }

        // ì§€ì—­ íŒë‹¨ í•¨ìˆ˜
        function isInRegion(address, region) {
            if (!address) return false;
            
            const extractedDong = extractDongFromAddress(address);
            console.log(`[DEBUG] ì£¼ì†Œ: "${address}", ì¶”ì¶œëœ ë™: "${extractedDong}", ì„ íƒëœ ì§€ì—­: "${region}"`);
            
            if (region === 'gangnam') {
                // ê°•ë‚¨êµ¬ ëª¨ë“  ë™ë“¤
                const gangnamDongs = [
                    'ì‹ ì‚¬ë™', 'ë…¼í˜„ë™', 'ì••êµ¬ì •ë™', 'ì²­ë‹´ë™', 'ì‚¼ì„±ë™', 'ëŒ€ì¹˜ë™', 
                    'ì—­ì‚¼ë™', 'ë„ê³¡ë™', 'ê°œí¬ë™', 'ì¼ì›ë™', 'ì„¸ê³¡ë™', 'ìˆ˜ì„œë™', 
                    'ìœ¨í˜„ë™', 'ìê³¡ë™'
                ];
                const isGangnam = address.includes('ê°•ë‚¨') || gangnamDongs.some(dong => address.includes(dong) || extractedDong === dong);
                console.log(`[DEBUG] ê°•ë‚¨êµ¬ íŒë‹¨ ê²°ê³¼: ${isGangnam}`);
                return isGangnam;
            } else if (region === 'songpa') {
                // ì†¡íŒŒêµ¬ ëª¨ë“  ë™ë“¤
                const songpaDongs = [
                    'ì ì‹¤ë™', 'ì‹ ì²œë™', 'í’ë‚©ë™', 'ì†¡íŒŒë™', 'ì„ì´Œë™', 'ì‚¼ì „ë™', 
                    'ê°€ë½ë™', 'ë¬¸ì •ë™', 'ì¥ì§€ë™', 'ë°©ì´ë™', 'ì˜¤ê¸ˆë™', 'ê±°ì—¬ë™', 
                    'ë§ˆì²œë™'
                ];
                const isSongpa = address.includes('ì†¡íŒŒ') || songpaDongs.some(dong => address.includes(dong) || extractedDong === dong);
                console.log(`[DEBUG] ì†¡íŒŒêµ¬ íŒë‹¨ ê²°ê³¼: ${isSongpa}`);
                return isSongpa;
            }
            
            return false;
        }

        // ê±°ë˜ë°©ì‹ íŒë‹¨ í•¨ìˆ˜
        function isTradeType(tradeType, targetType) {
            if (!tradeType) return false;
            
            const normalizedTradeType = tradeType.trim().toLowerCase();
            console.log(`[DEBUG] ê±°ë˜ë°©ì‹: "${tradeType}", ì •ê·œí™”: "${normalizedTradeType}", ëª©í‘œ: "${targetType}"`);
            
            if (targetType === 'ì „ì„¸') {
                return normalizedTradeType.includes('ì „ì„¸') || normalizedTradeType.includes('ì „ì„¸ê¶Œ');
            } else if (targetType === 'ì›”ì„¸') {
                return normalizedTradeType.includes('ì›”ì„¸') || normalizedTradeType.includes('ì›”ì„¸ê¶Œ');
            }
            
            return false;
        }

        // ì¹´í…Œê³ ë¦¬ íŒë‹¨ í•¨ìˆ˜
        function isCategory(property, category) {
            console.log(`[DEBUG] ì¹´í…Œê³ ë¦¬ í™•ì¸ - ì„ íƒ: "${category}", ë§¤ë¬¼ ë°ì´í„°:`, {
                ê³µí´: property.ê³µí´,
                ì˜¨í•˜: property.ì˜¨í•˜,
                ê° ë§¤: property.ê° ë§¤
            });
            
            if (category === 'ê³µí´') {
                const hasGongkul = property.ê³µí´ && property.ê³µí´.toString().trim() !== '' && property.ê³µí´.toString().trim() !== 'null' && property.ê³µí´.toString().trim() !== 'undefined';
                console.log(`[DEBUG] ê³µí´ í™•ì¸ ê²°ê³¼: ${hasGongkul}`);
                return hasGongkul;
            } else if (category === 'ì˜¨í•˜') {
                const hasOnha = property.ì˜¨í•˜ && property.ì˜¨í•˜.toString().trim() !== '' && property.ì˜¨í•˜.toString().trim() !== 'null' && property.ì˜¨í•˜.toString().trim() !== 'undefined';
                console.log(`[DEBUG] ì˜¨í•˜ í™•ì¸ ê²°ê³¼: ${hasOnha}`);
                return hasOnha;
            } else if (category === 'ê° ë§¤') {
                const hasGaenmae = property.ê° ë§¤ && property.ê° ë§¤.toString().trim() !== '' && property.ê° ë§¤.toString().trim() !== 'null' && property.ê° ë§¤.toString().trim() !== 'undefined';
                console.log(`[DEBUG] ê° ë§¤ í™•ì¸ ê²°ê³¼: ${hasGaenmae}`);
                return hasGaenmae;
            }
            
            return false;
        }

        // í•œê¸€ ê¸ˆì•¡ í‘œê¸°ë¥¼ ë§Œì› ë‹¨ìœ„ ìˆ«ìë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function parseKoreanAmount(str) {
            console.log(`[DEBUG] parseKoreanAmount ì…ë ¥: "${str}"`);
            if (!str || str === '-' || str === '0') return 0;
            
            // ìˆ«ìë§Œ ìˆëŠ” ê²½ìš° (ì´ë¯¸ ë§Œì› ë‹¨ìœ„)
            if (/^\d+$/.test(str.replace(/[,\s]/g, ''))) {
                const result = parseInt(str.replace(/[,\s]/g, ''));
                console.log(`[DEBUG] ìˆ«ìë§Œ ìˆëŠ” ê²½ìš°: ${result}`);
                return parseInt(str.replace(/[,\s]/g, ''));
            }
            
            let amount = 0;
            str = str.replace(/[,\s]/g, ''); // ì‰¼í‘œ, ê³µë°± ì œê±°
            console.log(`[DEBUG] ì •ë¦¬ëœ ë¬¸ìì—´: "${str}"`);
            
            // ì–µ ë‹¨ìœ„ ì²˜ë¦¬
            const eokMatch = str.match(/(\d+)ì–µ/);
            if (eokMatch) {
                amount += parseInt(eokMatch[1]) * 10000; // 1ì–µ = 10000ë§Œì›
                console.log(`[DEBUG] ì–µ ë‹¨ìœ„ ì¶”ê°€: ${eokMatch[1]}ì–µ = ${parseInt(eokMatch[1]) * 10000}ë§Œì›`);
            }
            
            // ì²œë§Œ ë‹¨ìœ„ ì²˜ë¦¬ (ì–µ ë’¤ì˜ ì²œ)
            const remainAfterEok = str.replace(/\d+ì–µ/, '');
            console.log(`[DEBUG] ì–µ ì œê±° í›„: "${remainAfterEok}"`);
            const cheonMatch = remainAfterEok.match(/(\d+)ì²œ/);
            if (cheonMatch) {
                amount += parseInt(cheonMatch[1]) * 1000; // 1ì²œë§Œ = 1000ë§Œì›
                console.log(`[DEBUG] ì²œ ë‹¨ìœ„ ì¶”ê°€: ${cheonMatch[1]}ì²œ = ${parseInt(cheonMatch[1]) * 1000}ë§Œì›`);
            }
            
            // ë§Œ ë‹¨ìœ„ ì²˜ë¦¬
            const manMatch = remainAfterEok.match(/(\d+)ë§Œ/);
            if (manMatch) {
                amount += parseInt(manMatch[1]); // ë§Œì› ë‹¨ìœ„ ê·¸ëŒ€ë¡œ
                console.log(`[DEBUG] ë§Œ ë‹¨ìœ„ ì¶”ê°€: ${manMatch[1]}ë§Œ = ${parseInt(manMatch[1])}ë§Œì›`);
            }
            
            // ë‹¨ìˆœ ìˆ«ìë§Œ ìˆëŠ” ê²½ìš° ì²˜ë¦¬ (ì–µ, ì²œ, ë§Œ ì œê±° í›„)
            const pureNumber = remainAfterEok.replace(/[ì–µì²œë§Œ]/g, '');
            if (pureNumber && /^\d+$/.test(pureNumber)) {
                // ë§Œ ë‹¨ìœ„ê°€ ì—†ê³  ìˆ«ìë§Œ ìˆëŠ” ê²½ìš°ëŠ” ë§Œì› ë‹¨ìœ„ë¡œ ê°€ì •
                if (!remainAfterEok.includes('ë§Œ') && !remainAfterEok.includes('ì²œ')) {
                    amount += parseInt(pureNumber);
                    console.log(`[DEBUG] ìˆœìˆ˜ ìˆ«ì ì¶”ê°€: ${pureNumber}ë§Œì›`);
                }
            }
            
            console.log(`[DEBUG] ìµœì¢… ê²°ê³¼: ${amount}ë§Œì›`);
            return amount;
        }

        async function onFilterSearch() {
            const keyword = document.getElementById('search-input').value.trim();
            const type = document.querySelector('input[name="type"]:checked').value; // 'villa'
            const regions = Array.from(document.querySelectorAll('input[name="region"]:checked')).map(cb => cb.value); // ê°•ë‚¨/ì†¡íŒŒ ë‹¤ì¤‘ ì„ íƒ
            const statuses = Array.from(document.querySelectorAll('input[name="status"]:checked')).map(cb => cb.value); // ì „ì„¸/ì›”ì„¸ ë‹¤ì¤‘ ì„ íƒ
            const categories = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(cb => cb.value); // ê³µí´/ì˜¨í•˜/ê° ë§¤ ë‹¤ì¤‘ ì„ íƒ
            const dateValue = document.querySelector('input[name="date"]:checked').value; // '0'(ì˜¤ëŠ˜), '1'(ì–´ì œ), '2'~'7'(Nì¼ ì „), or ''
            // ë³´ì¦ê¸ˆ/ì›”ì„¸ í•„í„° ê°’ ì½ê¸°
            const depositMin = document.getElementById('deposit-min').value;
            const depositMax = document.getElementById('deposit-max').value;
            const rentMin = document.getElementById('rent-min').value;
            const rentMax = document.getElementById('rent-max').value;
            const roomFilter = document.querySelector('input[name="room"]:checked').value; // '', '1', '2', '3'
            const today = new Date();
            const singleOnly = document.getElementById('singleOnlyCheckbox').checked;
            const bingoOnly = document.getElementById('bingoOnlyCheckbox').checked;
            const recommendOnly = document.getElementById('recommendOnlyCheckbox').checked;

            // ìƒ‰ê¹” í•„í„° ê°’ ì½ê¸° (ë¡œê·¸ì¸ ì‹œë§Œ í™œì„±í™”)
            const colorFilters = [];
            if (currentUser) {
                if (document.getElementById('redFilterCheckbox').checked) colorFilters.push('red');
                if (document.getElementById('orangeFilterCheckbox').checked) colorFilters.push('orange');
                if (document.getElementById('purpleFilterCheckbox').checked) colorFilters.push('purple');
                if (document.getElementById('greenFilterCheckbox').checked) colorFilters.push('green');
            }

            // í•­ìƒ ë¡œì»¬ í•„í„°ë§ë§Œ ìˆ˜í–‰ (ì§€ì—­ ë³€ê²½ ì‹œì—ë„ DB ì¬ë¡œë“œ ì—†ìŒ)
            // ë°ì´í„°ëŠ” ì•± ì‹œì‘ ì‹œ 1íšŒë§Œ ë¡œë“œë¨
            await filterAndDisplay();

            async function filterAndDisplay() {
                console.log(`[DEBUG] í•„í„°ë§ ì‹œì‘ - ì „ì²´ ë§¤ë¬¼:`, properties.length, 'ê°œ');

                // ë¹™ê³  í•„í„°: ë¹™ê³ ë§Œ ì²´í¬ëœ ê²½ìš° ë¹™ê³  ë°ì´í„°ë§Œ ì‚¬ìš©
                let baseData = properties;
                if (bingoOnly) {
                    baseData = bingoData;
                    console.log(`[DEBUG] ë¹™ê³  í•„í„° ì ìš© - ë¹™ê³  ë§¤ë¬¼:`, bingoData.length, 'ê°œ');
                }

                // ìƒ‰ê¹” í•„í„°: ì„ íƒëœ ìƒ‰ê¹”ì´ ìˆìœ¼ë©´ í•´ë‹¹ ìƒ‰ê¹” íƒœê·¸ëœ ë§¤ë¬¼ë§Œ
                if (colorFilters.length > 0) {
                    baseData = baseData.filter(row => {
                        const link = row['ë§í¬(URL)'] || row.ë§í¬ || row.url || row.URL;
                        const tagColor = userTagMap.get(link);
                        return tagColor && colorFilters.includes(tagColor);
                    });
                    console.log(`[DEBUG] ìƒ‰ê¹” í•„í„° ì ìš© - ë§¤ë¬¼:`, baseData.length, 'ê°œ');
                }

                // ì¶”ì²œ í•„í„°: ì¶”ì²œ ì²´í¬ ì‹œ ì¶”ì²œ ë§¤ë¬¼ë§Œ í‘œì‹œ
                if (recommendOnly) {
                    // ì¶”ì²œ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìµœì‹  ë°ì´í„° ë¡œë“œ (ìƒˆë¡œê³ ì¹¨ ì—†ì´ ì¶”ì²œ í™•ì¸ ê°€ëŠ¥)
                    if (recommendLinks.size === 0) {
                        await loadRecommendData();
                        console.log(`[DEBUG] ì¶”ì²œ ë°ì´í„° ìë™ ë¦¬ë¡œë“œ - ${recommendLinks.size}ê°œ`);
                    }
                    baseData = baseData.filter(row => {
                        const link = row['ë§í¬(URL)'] || row.ë§í¬ || row.url || row.URL;
                        return link && recommendLinks.has(link);
                    });
                    console.log(`[DEBUG] ì¶”ì²œ í•„í„° ì ìš© - ë§¤ë¬¼:`, baseData.length, 'ê°œ');
                }

                let filtered = baseData.filter(row => {
                    // 1. ë§¤ë¬¼ìœ í˜•: ëª¨ë“  ë§¤ë¬¼ì´ ë¹Œë¼ì´ë¯€ë¡œ í•­ìƒ true
                    const typeMatch = true;
                    
                    // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ë§¤ë¬¼ì˜ ì¢…ë¥˜ ì •ë³´ ì¶œë ¥
                    if (properties.indexOf(row) === 0) {
                        console.log(`[DEBUG] ì²« ë²ˆì§¸ ë§¤ë¬¼ ì¢…ë¥˜ ì •ë³´:`, {
                            ì¢…ë¥˜: row.ì¢…ë¥˜,
                            typeMatch: typeMatch
                        });
                    }

                    // 2. ì§€ì—­ í•„í„°: ë‹¤ì¤‘ ì„ íƒ ì§€ì›
                    const address = row.ì£¼ì†Œ || '';
                    const regionMatch = regions.length === 0 || regions.some(r => isInRegion(address, r));
                    
                    // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ë§¤ë¬¼ì˜ ì§€ì—­ ì •ë³´ ì¶œë ¥
                    if (properties.indexOf(row) === 0) {
                        console.log(`[DEBUG] ì²« ë²ˆì§¸ ë§¤ë¬¼ ì§€ì—­ ì •ë³´:`, {
                            ì£¼ì†Œ: row.ì£¼ì†Œ,
                            ì„ íƒëœì§€ì—­: regions,
                            regionMatch: regionMatch
                        });
                    }

                    // 3. ê±°ë˜ë°©ì‹ í•„í„°: ë‹¤ì¤‘ ì„ íƒ ì§€ì›
                    const tradeType = row.ê±°ë˜ë°©ì‹ || '';
                    const statusMatch = statuses.length === 0 || statuses.some(s => isTradeType(tradeType, s));
                    
                    // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ë§¤ë¬¼ì˜ ê±°ë˜ë°©ì‹ ì •ë³´ ì¶œë ¥
                    if (properties.indexOf(row) === 0) {
                        console.log(`[DEBUG] ì²« ë²ˆì§¸ ë§¤ë¬¼ ê±°ë˜ë°©ì‹ ì •ë³´:`, {
                            ê±°ë˜ë°©ì‹: row.ê±°ë˜ë°©ì‹,
                            ì„ íƒëœêµ¬ë¶„: statuses,
                            statusMatch: statusMatch
                        });
                    }

                    // 4. ë“±ë¡ì¼: 'ë“±ë¡/í™•ì¸ì¼' ê¸°ì¤€, ì •í™•íˆ í•´ë‹¹ ë“±ë¡ì¼ë§Œ ë³´ì´ê²Œ ì²˜ë¦¬
                    let dateOk = true;
                    if (dateValue) {
                        let regDate = row['ë“±ë¡/í™•ì¸ì¼'] || '';
                        regDate = regDate.replace(/[^0-9]/g, '');
                        if (regDate.length === 8) {
                            // ì˜¤ëŠ˜ 0ì‹œ ê¸°ì¤€
                            const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                            // ë“±ë¡ì¼ 0ì‹œ ê¸°ì¤€
                            const regStart = new Date(
                                parseInt(regDate.slice(0,4)),
                                parseInt(regDate.slice(4,6))-1,
                                parseInt(regDate.slice(6,8))
                            );
                            const diffDays = Math.floor((todayStart - regStart) / (1000*60*60*24));
                            const targetDays = parseInt(dateValue);
                            // ìƒˆë¡œìš´ ë¡œì§:
                            // "ì˜¤ëŠ˜" (value="0"): diffDays === 0
                            // "ì–´ì œ" (value="1"): diffDays === 1
                            // "Nì¼ ì „" (value="N", N>=2): diffDays === N
                            dateOk = diffDays === targetDays;
                        } else {
                            dateOk = false; // ë‚ ì§œ í˜•ì‹ì´ ì´ìƒí•˜ë©´ í•„í„°ì—ì„œ ì œì™¸
                        }
                    }

                    // 5. ë³´ì¦ê¸ˆ í•„í„°ë§
                    let depositOk = true;
                    if (depositMin || depositMax) {
                        const deposit = parseKoreanAmount(row.ì „ì„¸ê¸ˆ || '0');
                        if (depositMin && deposit < parseFloat(depositMin)) depositOk = false;
                        if (depositMax && deposit > parseFloat(depositMax)) depositOk = false;
                    }

                    // 6. ì›”ì„¸ í•„í„°ë§
                    let rentOk = true;
                    if (rentMin || rentMax) {
                        const rent = parseKoreanAmount(row.ì›”ì„¸ || '0');
                        if (rentMin && rent < parseFloat(rentMin)) rentOk = false;
                        if (rentMax && rent > parseFloat(rentMax)) rentOk = false;
                    }

                    // 7. ê³µí´/ì˜¨í•˜/ê° ë§¤ í•„í„°ë§: ë‹¤ì¤‘ ì„ íƒ ì§€ì›
                    const categoryMatch = categories.length === 0 || categories.some(cat => isCategory(row, cat));
                    
                    // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ë§¤ë¬¼ì˜ ì¹´í…Œê³ ë¦¬ ì •ë³´ ì¶œë ¥
                    if (properties.indexOf(row) === 0) {
                        console.log(`[DEBUG] ì²« ë²ˆì§¸ ë§¤ë¬¼ ì¹´í…Œê³ ë¦¬ ì •ë³´:`, {
                            ê³µí´: row.ê³µí´,
                            ì˜¨í•˜: row.ì˜¨í•˜,
                            ê° ë§¤: row.ê° ë§¤,
                            ì„ íƒëœì¹´í…Œê³ ë¦¬: categories,
                            categoryMatch: categoryMatch
                        });
                    }

                    // 8. í‚¤ì›Œë“œ(ì£¼ì†Œ/ë™/ê±´ë¬¼ëª…/ë§¤ë¬¼ëª…)
                    const keywordMatch = !keyword || (
                        (row.ì£¼ì†Œ && row.ì£¼ì†Œ.includes(keyword)) ||
                        (row.ê±´ë¬¼ëª… && row.ê±´ë¬¼ëª….includes(keyword)) ||
                        (row.ë§¤ë¬¼ëª… && row.ë§¤ë¬¼ëª….includes(keyword))
                    );

                    // 9. ë°©ìˆ˜ í•„í„°ë§
                    let roomCountOk = true;
                    if (roomFilter) {
                        const roomCount = parseInt(row.ë°©ìˆ˜) || 0;
                        if (roomFilter === '1') {
                            roomCountOk = roomCount === 1;
                        } else if (roomFilter === '2') {
                            roomCountOk = roomCount === 2;
                        } else if (roomFilter === '3') {
                            roomCountOk = roomCount >= 3;
                        }
                    }
                    
                    // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ë§¤ë¬¼ì˜ ë°©ìˆ˜ ì •ë³´ ì¶œë ¥
                    if (properties.indexOf(row) === 0) {
                        console.log(`[DEBUG] ì²« ë²ˆì§¸ ë§¤ë¬¼ ë°©ìˆ˜ ì •ë³´:`, {
                            ë°©ìˆ˜: row.ë°©ìˆ˜,
                            ì„ íƒëœë°©ìˆ˜í•„í„°: roomFilter,
                            roomCountOk: roomCountOk
                        });
                    }

                    const finalMatch = typeMatch && regionMatch && statusMatch && dateOk && depositOk && rentOk && categoryMatch && keywordMatch && roomCountOk;
                    
                    // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ë§¤ë¬¼ì˜ ìµœì¢… í•„í„° ê²°ê³¼ ì¶œë ¥
                    if (properties.indexOf(row) === 0) {
                        console.log(`[DEBUG] ì²« ë²ˆì§¸ ë§¤ë¬¼ ìµœì¢… í•„í„° ê²°ê³¼:`, {
                            typeMatch,
                            regionMatch,
                            statusMatch,
                            dateOk,
                            depositOk,
                            rentOk,
                            categoryMatch,
                            keywordMatch,
                            roomCountOk,
                            finalMatch
                        });
                    }
                    
                    return finalMatch;
                });

                // ë§¤ë¬¼1ê°œë§Œ ì²´í¬ ì‹œ, ì£¼ì†Œë³„ë¡œ 1ê°œë§Œ ë‚¨ê¸°ê¸°
                if (singleOnly) {
                    // ì£¼ì†Œë³„ ê·¸ë£¹í™”
                    const addressCount = {};
                    filtered.forEach(row => {
                        const addr = row.ì£¼ì†Œ || '';
                        addressCount[addr] = (addressCount[addr] || 0) + 1;
                    });
                    filtered = filtered.filter(row => addressCount[row.ì£¼ì†Œ || ''] === 1);
                }

                filteredProperties = filtered;
                console.log(`[DEBUG] í•„í„°ë§ëœ ë§¤ë¬¼:`, filteredProperties.length, 'ê°œ');
                console.log(`[DEBUG] í•„í„°ë§ëœ ì²« ë²ˆì§¸ ë§¤ë¬¼:`, filteredProperties[0]);
                displayMarkersOnMap();
                updateStatus(`ë§¤ë¬¼ ${filteredProperties.length}ê°œ í‘œì‹œ ì¤‘`);
                document.getElementById('totalCount').textContent = `ì´ ë§¤ë¬¼: ${properties.length}ê°œ`;
                document.getElementById('shownCount').textContent = `í‘œì‹œ ì¤‘: ${filteredProperties.length}ê°œ`;
            }
        }

        async function displayMarkersOnMap() {
            console.log(`[DEBUG] displayMarkersOnMap ì‹œì‘ - í•„í„°ë§ëœ ë§¤ë¬¼:`, filteredProperties.length, 'ê°œ');
            markers.forEach(marker => marker.setMap(null));
            markers = [];
            
            // ê°™ì€ ì£¼ì†Œì˜ ë§¤ë¬¼ë“¤ì„ ê·¸ë£¹í™”
            const groupedProperties = {};
            filteredProperties.forEach((property, index) => {
                const address = property.ì£¼ì†Œ || '';
                if (!groupedProperties[address]) {
                    groupedProperties[address] = [];
                }
                groupedProperties[address].push({...property, originalIndex: index});
            });
            
            console.log(`[DEBUG] ê·¸ë£¹í™”ëœ ì£¼ì†Œ ìˆ˜:`, Object.keys(groupedProperties).length);
            
            // ë°°ì¹˜ ì²˜ë¦¬ë¡œ ë§ˆì»¤ ìƒì„±
            const addresses = Object.keys(groupedProperties);
            const batchSize = 20; // í•œ ë²ˆì— ì²˜ë¦¬í•  ë§ˆì»¤ ìˆ˜ ì¦ê°€
            let processedCount = 0;
            
            async function processBatch() {
                const batch = addresses.slice(processedCount, processedCount + batchSize);
                
                for (const address of batch) {
                    const propertiesGroup = groupedProperties[address];
                    console.log(`[DEBUG] ì£¼ì†Œ ì²˜ë¦¬ ì¤‘: ${address} (${propertiesGroup.length}ê°œ ë§¤ë¬¼)`);
                    try {
                        const coords = await geocodeAddress(address);
                        if (coords) {
                            createMarker(propertiesGroup, coords, address);
                        }
                    } catch (error) {
                        console.warn(`ì£¼ì†Œ ë³€í™˜ ì‹¤íŒ¨: ${address}`, error);
                    }
                }
                
                processedCount += batchSize;
                updateStatus(`ë§ˆì»¤ ìƒì„± ì¤‘... (${Math.min(processedCount, addresses.length)}/${addresses.length})`);
                
                if (processedCount < addresses.length) {
                    // ë‹¤ìŒ ë°°ì¹˜ë¥¼ ë‹¤ìŒ í”„ë ˆì„ì— ì²˜ë¦¬
                    requestAnimationFrame(processBatch);
                } else {
                    console.log(`[DEBUG] ë§ˆì»¤ ìƒì„± ì™„ë£Œ: ${markers.length}ê°œ`);
                    updateStatus(`ë§ˆì»¤ ${markers.length}ê°œ í‘œì‹œ ì™„ë£Œ`);
                }
            }
            
            if (addresses.length > 0) {
                processBatch();
            } else {
                console.log(`[DEBUG] í‘œì‹œí•  ì£¼ì†Œê°€ ì—†ìŒ`);
                updateStatus('í‘œì‹œí•  ë§¤ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤');
            }
            // í‘œì‹œ ì¤‘ ë§¤ë¬¼ ê°œìˆ˜ ê°±ì‹ 
            document.getElementById('shownCount').textContent = `í‘œì‹œ ì¤‘: ${filteredProperties.length}ê°œ`;
        }

        function geocodeAddress(address) {
            // ìºì‹œì—ì„œ ë¨¼ì € í™•ì¸
            if (geocodeCache[address]) {
                return Promise.resolve(new naver.maps.LatLng(geocodeCache[address].lat, geocodeCache[address].lng));
            }
            
            return new Promise((resolve, reject) => {
                naver.maps.Service.geocode({
                    query: address
                }, function(status, response) {
                    if (status === naver.maps.Service.Status.ERROR) {
                        reject(new Error('Geocoding failed'));
                        return;
                    }

                    if (response.v2.meta.totalCount === 0) {
                        reject(new Error('No results found'));
                        return;
                    }

                    const result = response.v2.addresses[0];
                    const coords = new naver.maps.LatLng(result.y, result.x);
                   
                    // ìºì‹œì— ì €ì¥
                    geocodeCache[address] = { lat: result.y, lng: result.x };
                    saveGeocodeCache();
                   
                    resolve(coords);
                });
            });
        }

        function createMarker(propertiesGroup, coords, address) {
            console.log(`[DEBUG] ë§ˆì»¤ ìƒì„±: ${address} (${propertiesGroup.length}ê°œ ë§¤ë¬¼)`);
            const propertyCount = propertiesGroup.length;

            // ë¹™ê³  ë§¤ë¬¼ í¬í•¨ ì—¬ë¶€ í™•ì¸
            const hasBingo = propertiesGroup.some(p => {
                const link = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                return p.isBingo || (link && bingoLinks.has(link));
            });

            // ì‚¬ìš©ì ìƒ‰ê¹” íƒœê·¸ í™•ì¸ (ë¡œê·¸ì¸ ì‹œë§Œ)
            let userColor = null;
            if (currentUser) {
                for (const p of propertiesGroup) {
                    const link = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                    const tagColor = userTagMap.get(link);
                    if (tagColor) {
                        userColor = TAG_COLORS[tagColor].bg;
                        break;
                    }
                }
            }

            // ì¶”ì²œ ë§¤ë¬¼ í¬í•¨ ì—¬ë¶€ í™•ì¸
            const hasRecommend = propertiesGroup.some(p => {
                const link = p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL;
                return link && recommendLinks.has(link);
            });

            // ë§ˆì»¤ ìƒ‰ìƒ ê²°ì •: ë°˜ë°˜(ë¹™ê³ +ì‚¬ìš©ì) > ë°˜ë°˜(ë¹™ê³ +ì¶”ì²œ) > ë¹™ê³ (ê³¨ë“œ) > ì¶”ì²œ(í•‘í¬í…Œë‘ë¦¬) > ë³µìˆ˜(ì£¼í™©) > ë‹¨ì¼(íŒŒë€)
            let markerStyle, textColor;
            if (hasBingo && userColor) {
                // ë°˜ë°˜ ìƒ‰ìƒ: ì™¼ìª½ ë…¸ë€ìƒ‰(ë¹™ê³ ), ì˜¤ë¥¸ìª½ ì‚¬ìš©ì ìƒ‰ê¹”
                markerStyle = `background: linear-gradient(to right, #FFD700 50%, ${userColor} 50%);`;
                textColor = '#333';
            } else if (hasBingo && hasRecommend) {
                // ë¹™ê³  + ì¶”ì²œ: ê³¨ë“œì™€ í•‘í¬ ë°˜ë°˜
                markerStyle = 'background: linear-gradient(to right, #FFD700 50%, #E91E63 50%);';
                textColor = '#333';
            } else if (hasBingo) {
                markerStyle = 'background: #FFD700;';
                textColor = '#333';
            } else if (hasRecommend) {
                // ì¶”ì²œë§Œ: í•‘í¬ í…Œë‘ë¦¬
                markerStyle = 'background: #3182F6; border: 3px solid #E91E63 !important;';
                textColor = 'white';
            } else if (propertyCount > 1) {
                markerStyle = 'background: #FF6B35;';
                textColor = 'white';
            } else {
                markerStyle = 'background: #3182F6;';
                textColor = 'white';
            }

            // í…ìŠ¤íŠ¸ í‘œì‹œ: ë¹™ê³ =â˜…, ì¶”ì²œ=â¤
            let prefixText = '';
            if (hasBingo) prefixText += 'â˜… ';
            if (hasRecommend) prefixText += 'â¤ ';
            const displayText = prefixText + (propertyCount > 1 ? `${address} (${propertyCount}ê°œ)` : address);

            const marker = new naver.maps.Marker({
                position: coords,
                map: map,
                title: displayText,
                icon: {
                    content: `<div style="${markerStyle} color: ${textColor}; padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.18); max-width:180px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${displayText}</div>`,
                    size: new naver.maps.Size(30, 30),
                    anchor: new naver.maps.Point(15, 15)
                }
            });
            // ì •ë³´ì°½ ìƒì„±
            const infoWindow = new naver.maps.InfoWindow({
                content: createInfoWindowContent(propertiesGroup),
                maxWidth: 320,
                backgroundColor: "#fff",
                borderColor: "#ccc",
                borderWidth: 1,
                anchorSize: new naver.maps.Size(10, 10),
                anchorSkew: true,
                anchorColor: "#fff",
                pixelOffset: new naver.maps.Point(0, -10)
            });
            marker.isOpen = false;
            naver.maps.Event.addListener(marker, 'click', function() {
                if (marker.isOpen) {
                    infoWindow.close();
                    marker.isOpen = false;
                } else {
                    markers.forEach(m => { if (m.infoWindow) { m.infoWindow.close(); m.isOpen = false; } });
                    infoWindow.open(map, marker);
                    marker.isOpen = true;
                }
            });
            marker.infoWindow = infoWindow;
            // ë§ˆì»¤ì— ë§í¬ ì •ë³´ ì €ì¥ (ê°œë³„ ë§ˆì»¤ ì—…ë°ì´íŠ¸ìš©)
            marker.links = propertiesGroup.map(p => p['ë§í¬(URL)'] || p.ë§í¬ || p.url || p.URL).filter(Boolean);
            marker.propertiesGroup = propertiesGroup;
            markers.push(marker);
        }

        function createInfoWindowContent(propertiesGroup) {
            const address = propertiesGroup[0].ì£¼ì†Œ || '';
            const propertyCount = propertiesGroup.length;
            
            let content = `
                <div style="padding: 18px; font-family: 'Segoe UI', sans-serif; min-width:280px; max-width:400px;">
                    <div style="font-size:16px; color:#333D4B; font-weight:700; margin-bottom:12px; border-bottom:2px solid #E5E8EB; padding-bottom:8px;">
                        ${address}
                        <span style="color:#3182F6; font-size:14px; font-weight:600; margin-left:8px;">(${propertyCount}ê°œ ë§¤ë¬¼)</span>
                    </div>
                    <div style="max-height:300px; overflow-y:auto; padding-right:8px;">
            `;
            
            propertiesGroup.forEach((property, index) => {
                // ë“±ë¡ì¼ í‘œê¸° (yyyy-mm-dd)
                let date = property['ë“±ë¡/í™•ì¸ì¼'] || property.í™•ì¸ì¼ || property.ë“±ë¡ì¼ || '';
                if (date && date.length >= 8) {
                    date = date.replace(/[^0-9]/g, '');
                    if (date.length === 8) date = `${date.slice(0,4)}-${date.slice(4,6)}-${date.slice(6,8)}`;
                }
                // ë³´ì¦ê¸ˆ(ì „ì„¸ê¸ˆ), ì›”ì„¸
                const deposit = property.ì „ì„¸ê¸ˆ || '';
                const rent = property.ì›”ì„¸ || '';
                // ë§í¬
                const link = property['ë§í¬(URL)'] || property.ë§í¬ || property.url || property.URL;

                // ë¹™ê³  ìƒíƒœ í™•ì¸
                const isBingo = property.isBingo || (link && bingoLinks.has(link));
                const starStyle = isBingo
                    ? 'color:#FFD700; font-size:22px; cursor:pointer; text-shadow: 0 0 3px #FFA500;'
                    : 'color:#ccc; font-size:22px; cursor:pointer;';
                const starTitle = isBingo ? 'ë¹™ê³  í•´ì œ' : 'ë¹™ê³  ì¶”ê°€';

                // ë³„í‘œ ë²„íŠ¼ HTML (ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ í´ë¦­ ê°€ëŠ¥)
                const starButtonHtml = link
                    ? `<span onclick="window.toggleBingoFromInfo(${index}, '${link.replace(/'/g, "\\'")}', this)" style="${starStyle}" title="${starTitle}">â˜…</span>`
                    : '';

                // ìƒ‰ê¹” ë²„íŠ¼ HTML (ë¡œê·¸ì¸ ì‚¬ìš©ì + ë¹™ê³  ë§¤ë¬¼ë§Œ)
                let colorButtonsHtml = '';
                if (currentUser && isBingo && link) {
                    const currentColor = userTagMap.get(link);
                    const escapedLink = link.replace(/'/g, "\\'");
                    colorButtonsHtml = '<span style="margin-left:4px;">';
                    for (const [colorKey, colorInfo] of Object.entries(TAG_COLORS)) {
                        const isSelected = currentColor === colorKey;
                        const opacity = isSelected ? '1' : '0.4';
                        colorButtonsHtml += `<span onclick="window.toggleColorTagFromInfo('${escapedLink}', '${colorKey}', this)" style="cursor:pointer; font-size:14px; opacity:${opacity};" title="${colorInfo.name}">${colorInfo.emoji}</span>`;
                    }
                    colorButtonsHtml += '</span>';
                }

                // ì¶”ì²œ ìƒíƒœ í™•ì¸ (ëª¨ë“  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆìŒ)
                const isRecommend = link && recommendLinks.has(link);
                const heartStyle = isRecommend
                    ? 'color:#E91E63; font-size:20px; cursor:pointer; text-shadow: 0 0 3px #E91E63;'
                    : 'color:#ccc; font-size:20px; cursor:pointer;';
                const heartTitle = isRecommend ? 'ì¶”ì²œ í•´ì œ' : 'ì¶”ì²œ';

                // í•˜íŠ¸ ë²„íŠ¼ HTML (íŒ€ì¥ ëª¨ë“œì—ì„œë§Œ í´ë¦­ ê°€ëŠ¥, í•˜ì§€ë§Œ ëª¨ë“  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆìŒ)
                let heartButtonHtml = '';
                if (link) {
                    const escapedLink = link.replace(/'/g, "\\'");
                    if (isTeamleadMode) {
                        // íŒ€ì¥: í´ë¦­ ê°€ëŠ¥
                        heartButtonHtml = `<span onclick="window.toggleRecommendFromInfo('${escapedLink}', this)" style="${heartStyle} margin-left:4px;" title="${heartTitle}">â¤</span>`;
                    } else if (isRecommend) {
                        // ì¼ë°˜ ì‚¬ìš©ì: ì¶”ì²œëœ ê²½ìš°ë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€)
                        heartButtonHtml = `<span style="color:#E91E63; font-size:20px; margin-left:4px; text-shadow: 0 0 3px #E91E63;" title="íŒ€ì¥ ì¶”ì²œ">â¤</span>`;
                    }
                }

                // ë°°ê²½ìƒ‰: ë¹™ê³  ë§¤ë¬¼ì€ ì—°í•œ ë…¸ë€ìƒ‰
                const bgColor = isBingo ? '#FFFBEB' : '#F9FAFB';
                const borderColor = isBingo ? '#FFD700' : '#E5E8EB';

                content += `
                    <div style="border:2px solid ${borderColor}; border-radius:8px; padding:12px; margin-bottom:8px; background:${bgColor};">
                        <div style="font-size:14px; color:#191F28; font-weight:600; margin-bottom:6px; display:flex; justify-content:space-between; align-items:center;">
                            <span>ë§¤ë¬¼ ${index + 1}</span>
                            <span>${starButtonHtml}${heartButtonHtml}${colorButtonsHtml}</span>
                        </div>
                        <div style="font-size:14px; color:#191F28; margin-bottom:4px;">ë³´ì¦ê¸ˆ <b>${deposit}</b> / ì›”ì„¸ <b>${rent}</b></div>
                        <div style="font-size:13px; color:#6B7684; margin-bottom:4px;">ê±°ë˜ë°©ì‹ : ${property.ê±°ë˜ë°©ì‹ || '-'}</div>
                        <div style="font-size:13px; color:#6B7684; margin-bottom:8px;">ë“±ë¡ì¼ : ${date || '-'}</div>
                        <div style="text-align:center;">
                            ${link && link !== 'undefined' && link !== 'null' && link.trim() !== ''
                                ? `<a href="${/^https?:\/\//i.test(link) ? link : 'https://' + link}" target="_blank" style="display:inline-block; background:#3182F6; color:#fff; font-weight:600; border-radius:6px; padding:6px 12px; text-decoration:none; font-size:13px;">ìƒì„¸ë³´ê¸°</a>`
                                : `<span style="color: #aaa; font-size: 12px;">ìƒì„¸ ë§í¬ ì—†ìŒ</span>`
                            }
                        </div>
                    </div>
                `;
            });
            
            content += `
                    </div>
                </div>
            `;
            
            return content;
        }

        function selectProperty(index) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.property-item').forEach(item => {
                item.classList.remove('selected');
            });

            // ìƒˆë¡œìš´ ì„ íƒ
            const propertyItem = document.querySelector(`[data-index="${index}"]`);
            if (propertyItem) {
                propertyItem.classList.add('selected');
                selectedProperty = properties[index];
                
                // ì§€ë„ ì¤‘ì‹¬ ì´ë™
                if (markers[index]) {
                    map.setCenter(markers[index].getPosition());
                    map.setZoom(15);
                }
            }
        }

        function openPropertyLink(url) {
            if (url) {
                // http(s)://ë¡œ ì‹œì‘í•˜ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ ë¶™ì—¬ì¤Œ
                if (!/^https?:\/\//i.test(url)) {
                    url = 'https://' + url;
                }
                window.open(url, '_blank');
            }
        }

        function updateStatus(message) {
            document.getElementById('statusBar').textContent = message;
        }



        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            
            document.body.insertBefore(errorDiv, document.body.firstChild);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function hideLoading() {
            const loading = document.getElementById('loading');
            if (loading) {
                loading.style.display = 'none';
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (ì •ë³´ì°½ì—ì„œ ì‚¬ìš©)
        window.openPropertyLink = openPropertyLink;
    </script>
</body>
</html> 